<section id="ways-we-work" class="s67" aria-label="Ways We Work" tabindex="0">
  
  <style>
    
    /* Local fonts (paths unchanged) */
    @font-face { font-family:'Eyesome';        src:url('./Fonts/Eyesome-Regular.otf')       format('opentype'); font-display:swap; }
    @font-face { font-family:'Arsenica';       src:url('./Fonts/ArsenicaTrial-Regular.otf') format('opentype'); font-display:swap; }
    @font-face { font-family:'Canela';         src:url('./Fonts/Canela-Bold.otf')           format('opentype'); font-display:swap; }
    @font-face { font-family:'Anecor';         src:url('./Fonts/anecor-gheroos.otf')        format('opentype'); font-display:swap; }
    @font-face { font-family:'cotorisi';       src:url('./Fonts/cotorisita.otf')            format('opentype'); font-weight:400; font-style:normal; font-display:swap; }

    /* ===== Scoped tokens ===== */
    #ways-we-work{
      --bg:transparent; --ink:#13294b; --muted:#6f6d69;
      --hair:#e3dfd7; --ivory:#f7f2e7; --ink-ivory:#23201a;
      --radius:16px; --hairline:1px;
      --gutter: clamp(16px, 4vw, 40px);
      --lux:cubic-bezier(.22,.61,.36,1);
      --open-ease: cubic-bezier(.16,.84,.44,1);
      --t-fast:260ms; --t:520ms; --t-long:900ms;
      --ret-dur: var(--t); /* default return = normal timing */

      --cw-min: 180px; --cw-max: 220px;
      --cw-exp-min: 260px; --cw-exp-max: 300px;
      --ch-min: 56px; --ch-min-open: 120px;

      /* Parallax driver (kept at 0 so no effect) */
      --scr: 0;

      /* BULLET defaults */
      --bullet: '✧';
      --ff-bullet: var(--ff-card-title, 'Canela');
      --fs-bullet: 0.90em;

      /* Icon bullet knobs */
      --bullet-img: url('./icons/diamond.svg');
      --bullet-size: 0.48em;
      --bullet-color: currentColor;
      --bullet-offset-x: 0.15em;
      --bullet-offset-y: 0.35em;

      position: relative;
      display:block;
      min-height:100svh;
      background:var(--bg); color:var(--ink);
      overflow:hidden;
      -webkit-tap-highlight-color: transparent;
      touch-action: auto; /* ← allow normal page scrolling */
      font:104px/1.2 cotorisi,ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    #ways-we-work *, #ways-we-work *::before, #ways-we-work *::after{ box-sizing:border-box; }

    /* ===== Hero ===== */
    #ways-we-work .hero{ position:sticky; top:0; height:100vh; display:grid; place-items:center; }
    #ways-we-work .hero__inner{
      position:relative;
      z-index:10; /* links stay clickable */
      text-align:center; max-width:86ch; padding:0 var(--gutter);
      transform: translateY(calc(var(--scr) * -6vh)) scale(calc(1 - var(--scr) * 0.15));
      opacity: calc(1 - var(--scr) * 0.6);
      filter: blur(calc(var(--scr) * 1.5px));
      will-change: transform, opacity, filter;
    }
    #ways-we-work .title{ font-family:'Eyesome'; font-weight:650; letter-spacing:-.01em; font-size: clamp(28px, 6vw, 84px); }
    #ways-we-work .sub{ margin:.5rem auto 0; color:color-mix(in oklab, var(--ink) 68%, transparent); font-size: clamp(16px, 2.2vw, 22px); max-width: 72ch; }

    /* ===== Scatter layer with focus boxes ===== */
    #ways-we-work .scatter{
      position:absolute; inset:0;
      z-index:40; /* ↑ ABOVE hero__inner (10) so boxes overlay */
      pointer-events:auto;
      filter: saturate(calc(1 - var(--scr) * .08));
      isolation:isolate;
    }

    #ways-we-work .hbox{
      pointer-events:auto; position:absolute;
      transform:
        translate(-50%, -50%)
        translateX(calc(var(--dir, 1) * var(--scr) * 40vw))
        translateY(calc(var(--scr) * -6vh))
        scale(calc(1 - var(--scr) * 0.12));
      border:1px solid rgba(0,0,0,.06); border-radius:var(--radius);
      background: var(--bg); color: var(--ink);
      min-width: var(--cw-min); max-width: var(--cw-max);
      min-height: var(--ch-min);
      padding:10px 12px;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      cursor:pointer;
      transition:
        box-shadow var(--t) var(--open-ease),
        transform  var(--ret-dur, var(--t)) var(--open-ease),
        opacity    var(--ret-dur, var(--t)) var(--open-ease),
        background var(--t) var(--open-ease),
        color      var(--t) var(--open-ease),
        border-color var(--t) var(--open-ease),
        filter     var(--t) var(--open-ease),
        padding    var(--t) var(--open-ease),
        min-width  var(--t) var(--open-ease),
        max-width  var(--t) var(--open-ease),
        min-height var(--t) var(--open-ease),
        z-index    var(--t-fast) linear;
      box-shadow: 0 0 0 rgba(0,0,0,0);
      will-change: transform, box-shadow, filter, min-width, max-width, padding, min-height, background, color, border-color;
      animation: s67-drift calc(9s + var(--rand-dur, 0s)) ease-in-out infinite alternate;
      z-index:41; /* ↑ default above hero */
    }
    #ways-we-work .hbox:hover{
      box-shadow: 0 14px 42px rgba(0,0,0,.12); border-color: rgba(0,0,0,.12); background:#fff; color: var(--ink);
      z-index:50; /* ↑ hover */
    }
    #ways-we-work .hbox:focus-visible{ outline: 2px solid rgba(0,0,0,.25); outline-offset: 2px; z-index:60; }

    #ways-we-work .label{ display:block; text-align:center; margin:0 auto; font-size:14px; letter-spacing:.04em; font-weight:600; color:#2b2925; opacity:.98; }

    /* Content card that opens (NO headline inside) */
    #ways-we-work .card{
      position:relative; width:100%; margin-top:0; background: var(--ivory); color: var(--ink-ivory);
      border: 1px solid rgba(35,32,26,.14); border-radius: calc(var(--radius) + 2px);
      box-shadow: 0 1px 0 rgba(255,255,255,.35) inset, 0 24px 60px rgba(0,0,0,.20);
      padding:12px; opacity:0; pointer-events:none;
      transform-origin: top center;
      transform: translateY(6px) scale(.985);
      filter: blur(.6px);
      max-height:0; overflow:hidden;
      transition:
        opacity var(--t) var(--open-ease),
        transform var(--t) var(--open-ease),
        filter var(--t-fast) var(--open-ease),
        max-height var(--t-long) var(--open-ease),
        padding var(--t) var(--open-ease);
    }
    #ways-we-work .hbox.is-open{
      box-shadow: 0 28px 90px rgba(0,0,0,.18); background:#fff; color: var(--ink); border-color: rgba(0,0,0,.12);
      min-width: var(--cw-exp-min); max-width: var(--cw-exp-max); min-height: var(--ch-min-open); padding:16px;
      backdrop-filter: saturate(1.05) blur(1px); align-items:stretch;
      z-index:999; /* ↑ opened cards sit on TOP of everything in section */
    }
    #ways-we-work .hbox.is-open .card{
      margin-top:12px; opacity:1; pointer-events:auto;
      transform: translateY(0) scale(1);
      filter: blur(0);
      max-height: 70vh; overflow:auto;
    }

    /* BULLET LIST styling */
    #ways-we-work .card ul{ margin:0; padding:0; list-style:none; }
    #ways-we-work .card li{
      position:relative; margin:.35rem 0;
      padding-left:1.05em;
      font-size: clamp(14px, 1.9vw, 18px);
      line-height: 1.35;
    }
    #ways-we-work .card li::before{
      content: var(--bullet, '—');
      position:absolute; left:0;
      font-family: var(--ff-bullet);
      font-size: var(--fs-bullet);
      line-height:1;
      opacity:.9;
      top: .40em;
    }

    /* ICON bullet mode */
    #ways-we-work.bul-img .card li::before,
    #ways-we-work .card.bul-img li::before{
      content:"";
      width:var(--bullet-size); height:var(--bullet-size);
      left:var(--bullet-offset-x); top:var(--bullet-offset-y);
      background: var(--bullet-color);
      -webkit-mask: var(--bullet-img) no-repeat center / contain;
      mask: var(--bullet-img) no-repeat center / contain;
    }

    @keyframes s67-drift{ from{ translate:0 0 } to{ translate: 0 8px } }

    @media (max-width: 720px){
      #ways-we-work{ --cw-min: 170px; --cw-max: 210px; --cw-exp-min: 240px; --cw-exp-max: 280px; }
    }

    @media (prefers-reduced-motion: reduce){
      #ways-we-work *{ animation:none !important; transition:none !important; }
    }

    /* ================== CTA LINKS (text → pill) ================== */
    #ways-we-work .inline-cta{
      position: relative;
      display:inline-flex;
      align-items:center;
      padding:.3em .56em;
      border-radius:100px;
      text-decoration:none;
      font-family: 'Arsenica';
      font-weight:600;
      line-height:1.1;
      color: var(--ink);
      border: 1px solid transparent;
      transition:
        background .22s var(--lux),
        border-color .22s var(--lux),
        box-shadow .22s var(--lux),
        transform .22s var(--lux);
      background-image: linear-gradient(currentColor,currentColor);
      background-size: 100% 1px;
      background-repeat: no-repeat;
      background-position: 0 100%;
    }
    #ways-we-work .inline-cta:hover,
    #ways-we-work .inline-cta:focus-visible{
      background:#fff;
      border-color: rgba(35,32,26,.18);
      box-shadow: 0 6px 22px rgba(0,0,0,.10);
      transform: translateY(-1px);
      background-image: none;
    }
    #ways-we-work .inline-cta:active{
      transform: translateY(0);
      box-shadow: 0 3px 12px rgba(0,0,0,.08);
    }
    #ways-we-work .inline-cta--solid{
      background:#fff;
      border-color: rgba(35,32,26,.18);
      background-image:none;
    }

    /* ============= TRANSITION TO SECTION 7 (added) ============= */

    /* always have a transition so fade-in works too */
#ways-we-work .hero__inner [data-exit="fade"]{
  transition: opacity 600ms var(--lux), filter 600ms var(--lux);
}

/* only change the values when exiting */
#ways-we-work.is-exiting .hero__inner [data-exit="fade"]{
  opacity:0;
  filter: blur(2px);
}

    /* Sweep boxes left/right off-screen; pause their float; stop clicks */
    #ways-we-work.is-exiting .scatter{ pointer-events:none; }
    #ways-we-work.is-exiting .hbox{
      animation-play-state: paused;
      transition:
        transform 900ms var(--open-ease),
        opacity 900ms var(--open-ease),
        box-shadow 300ms linear;
      transform:
        translate(-50%, -50%)
        translateX(calc(var(--dir, 1) * 120vw)) /* ← sweep off-screen */
        translateY(0)
        scale(1);
      opacity: 0.95;
      box-shadow: 0 6px 24px rgba(0,0,0,.08);
    }

    /* Lock interactions while exiting */
    #ways-we-work.is-exiting{ pointer-events:none; }

    /* Reduced motion: cross-fade quickly */
    @media (prefers-reduced-motion: reduce){
      #ways-we-work.is-exiting .hbox{
        transform: translate(-50%,-50%); opacity:0;
        transition: opacity 300ms linear;
      }
      #ways-we-work.is-exiting .hero__inner [data-exit="fade"]{
        opacity:0; filter:none; transition: opacity 200ms linear;
      }
    }
  </style>

  <!-- === TYPOGRAPHY TWEAKS (unchanged) === -->
  <style id="ways-typo-tweaks">
    /* Families */
    #ways-we-work{
      --ff-base: cotorisi, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;

      --ff-hero-title: 'Eyesome', serif;
      --ff-hero-sub:   var(--ff-base);
      --ff-hero-sub2:  var(--ff-base);

      --ff-label: 'Arsenica', var(--ff-base);

      /* Floating open card (no headline inside) */
      --ff-hbox-body:  var(--ff-base);

      --ff-reveal-title: 'Eyesome', serif;
      --ff-reveal-sub:   var(--ff-base);

      --ff-reveal-card-title: 'Canela', var(--ff-base);
      --ff-reveal-card-body:  'Centaur', var(--ff-base);

      --ff-bullet: var(--ff-reveal-card-title);
    }

    /* Sizes */
    #ways-we-work{
      --fs-hero-title: clamp(28px, 12vw, 104px);
      --fs-hero-sub:   clamp(16px, 4vw, 22px);
      --fs-hero-sub2:  clamp(15px, 2.4vw, 18px);

      --fs-label:      17px;

      --fs-hbox-body:  clamp(14px, 3.5vw, 20px);

      --fs-reveal-title: clamp(22px, 3.4vw, 42px);
      --fs-reveal-sub:   clamp(15px, 1.9vw, 18px);

      --fs-reveal-card-title: clamp(16px, 2.2vw, 20px);
      --fs-reveal-card-body:  clamp(14px, 1.9vw, 18px);

      --fs-bullet-hbox:   0.85em;
      --fs-bullet-reveal: 1.05em;

      --gap-hero-title-sub: .012rem;
      --gap-hero-sub-sub2:  .10rem;

      --hero-sub2-shift-x: 18px;
      --hero-sub2-shift-y: 180px;
    }

    /* Weights */
    #ways-we-work{
      --fw-hero-title: 400;
      --fw-hero-sub:   400;
      --fw-hero-sub2:  400;

      --fw-label:      600;

      --fw-hbox-body:  400;

      --fw-reveal-title: 650;
      --fw-reveal-sub:   400;

      --fw-reveal-card-title: 700;
      --fw-reveal-card-body:  400;
    }

    /* Letter-spacing */
    #ways-we-work{
      --ls-hero-title: -0.01em;
      --ls-hero-sub:    0em;
      --ls-hero-sub2:   0em;

      --ls-label:       0.04em;

      --ls-hbox-body:   0em;

      --ls-reveal-title: -0.01em;
      --ls-reveal-sub:    0em;

      --ls-reveal-card-title: 0em;
      --ls-reveal-card-body:  0em;
    }

    /* Line-heights */
    #ways-we-work{
      --lh-hero-title: 1.08;
      --lh-hero-sub:   1.45;
      --lh-hero-sub2:  1.45;

      --lh-label:      1.2;

      --lh-hbox-body:  1.2;

      --lh-reveal-title: 1.2;
      --lh-reveal-sub:   1.45;

      --lh-reveal-card-title: 1.2;
      --lh-reveal-card-body:  1.5;
    }

    /* === APPLY OVERRIDES (type only) === */
    /* HERO */
    #ways-we-work .hero .title{
      font-family: var(--ff-hero-title) !important;
      font-size:   var(--fs-hero-title) !important;
      font-weight: var(--fw-hero-title) !important;
      letter-spacing: var(--ls-hero-title) !important;
      line-height: var(--lh-hero-title) !important;
      margin: 0 0 var(--gap-hero-title-sub) !important;
    }
    #ways-we-work .hero .sub{
      font-family: var(--ff-hero-sub) !important;
      font-size:   var(--fs-hero-sub) !important;
      font-weight: var(--fw-hero-sub) !important;
      letter-spacing: var(--ls-hero-sub) !important;
      line-height: var(--lh-hero-sub) !important;
      margin: 0 !important;
    }
    /* second subtext line */
    #ways-we-work .hero .sub2{
      font-family: var(--ff-hero-sub2) !important;
      font-size:   var(--fs-hero-sub2) !important;
      font-weight: var(--fw-hero-sub2) !important;
      letter-spacing: var(--ls-hero-sub2) !important;
      line-height: var(--lh-hero-sub2) !important;
      margin: var(--gap-hero-sub-sub2) auto 0 !important;
      transform: translate(var(--hero-sub2-shift-x), var(--hero-sub2-shift-y));
    }

    /* FLOATING BOX (closed label) */
    #ways-we-work .hbox .label{
      font-family: var(--ff-label) !important;
      font-size:   var(--fs-label) !important;
      font-weight: var(--fw-label) !important;
      letter-spacing: var(--ls-label) !important;
      line-height: var(--lh-label) !important;
    }

    /* FLOATING BOX (open card body only — no headline) */
    #ways-we-work .hbox .card p,
    #ways-we-work .hbox .card li{
      font-family: var(--ff-hbox-body) !important;
      font-size:   var(--fs-hbox-body) !important;
      font-weight: var(--fw-hbox-body) !important;
      letter-spacing: var(--ls-hbox-body) !important;
      line-height: var(--lh-hbox-body) !important;
    }
    #ways-we-work .hbox .card li::before{ font-size: var(--fs-bullet-hbox) !important; }
  </style>

  <main class="hero">
    <div class="hero__inner">
      <h1 class="title" data-exit="fade">Trust Us?</h1>
      <p class="sub" data-exit="fade">Trust is an assumption, & Assumptions ....! <br> Clarity Won't. Achieve yours by reading floating truths.</p>
      <p class="sub sub2" data-exit="fade">
        Wish to explore more – check out our
        <a class="inline-cta" href="/writings" role="button" aria-label="Open Writings">WRITINGS</a>
        and
        <a class="inline-cta" href="/instruments" role="button" aria-label="Open Instruments">INSTRUMENTS</a>.
      </p>
    </div>

    <div class="scatter" aria-live="polite">
      <!-- Initial static hboxes are replaced by JS render() -->
    </div>
  </main>

  <script>
    (function(){
      const sec = document.getElementById('ways-we-work');
      const scatter = sec.querySelector('.scatter');

      const LUX_LAYOUT = true;

      function toListHTML(content){
        if (Array.isArray(content)){
          return '<ul>' + content.map(x => `<li>${x}</li>`).join('') + '</ul>';
        }
        return '<ul><li>' + (content ?? '') + '</li></ul>';
      }

      const DATA = [
        { label:'Perception > Value',           title:'Perception > Value',           body:['Perception often outweighs real value','The mind fills gaps by constructing meaning','Value is justified before the experience even begins'], x:50, y:18 },
        { label:'Silence > Words',              title:'Silence > Words',              body:['Silence creates space for value to grow','Paired with posture/presence/gaze, it eclipses speech'], x:18, y:82 },
        { label:'Conversation = Argument',      title:'Conversation = Argument',      body:['Everyone wants to be heard','Reflect their view back; gain an ally and information'], x:83, y:80 },
        { label:'Complexity = Facade',          title:'Complexity = Facade',          body:['Complexity is often a cover — a facade to confuse or distract.','The less you understand, the more value you assign. Just mind games.'], x:79, y:50 },
        { label:'Price = Positioning',          title:'Price = Positioning',          body:['The mind reads price as truth—long before it sees proof.','High cost implies high value, and most people don’t question it.','The real game is holding still long enough to let belief form.'], x:16, y:16 },
        { label:'Information = Power',          title:'Information = Everything',     body:['Most people don’t lack data—they lack eyes.','Some truths are buried. Others are visible but emotionally inconvenient.','Power goes to the one who notices, names, and moves first.'], x:17, y:58 },
        { label:'Emotion Buys. Logic Justifies.',title:'Emotion Buys. Logic Justifies.', body:['We feel first, think later.','Every “rational” decision is a story stitched to a gut call.'], x:80, y:15 },
        { label:'Activity ≠ Progress',          title:'Activity ≠ Progress',          body:['They’re busy, not effective.','Clarity kills 90% of motion—and doubles momentum.'], x:18, y:34 },
        { label:'Self-Doubt ≠ Lack of Skill',   title:'Self-Doubt ≠ Lack of Skill',   body:['Most doubt doesn’t come from being bad.','It comes from being alone in your seeing.'], x:51, y:85 },
        { label:'Talent ≠ Money',               title:'Talent ≠ Money',               body:['Talent alone does not get you paid — right positioning at right time does.','World does not pay for your expertise — it pays for their perception of it.'], x:80, y:30 },
      ];

      const ANCHORS = [
        {x:14, y:24}, {x:30, y:16}, {x:46, y:22}, {x:62, y:18}, {x:78, y:26},
        {x:84, y:48}, {x:79, y:76}, {x:54, y:78}, {x:36, y:74}, {x:20, y:56}
      ];

      function jitter(n, amt){ return n + (Math.random()*2-1)*amt; }
      function clamp(v, lo, hi){ return Math.max(lo, Math.min(hi, v)); }

      function applyLuxLayout(items){
        const isMobile = matchMedia('(max-width: 720px)').matches;
        const xJ = isMobile ? 1.5 : 2.5;
        const yJ = isMobile ? 2.0 : 3.5;
        return items.map((it, i)=>{
          const a = ANCHORS[i % ANCHORS.length];
          const X = clamp(jitter(a.x, xJ), 8, 92);
          const Y = clamp(jitter(a.y, yJ), 10, 90);
          return { ...it, x:X, y:Y };
        });
      }

      function buildBox(it){
        const el = document.createElement('div');
        el.className = 'hbox';
        el.style.left = (typeof it.x === 'number' ? it.x + '%' : it.x);
        el.style.top  = (typeof it.y === 'number' ? it.y + '%' : it.y);
        el.style.setProperty('--rand-dur', (Math.random()*2).toFixed(2) + 's');
        el.style.animationDelay = `${(-Math.random()*6).toFixed(2)}s`;
        const xNum = (typeof it.x === 'number') ? it.x : parseFloat(it.x);
        el.style.setProperty('--dir', (xNum < 50 ? -1 : 1));
        el.setAttribute('role','button'); el.setAttribute('tabindex','0'); el.setAttribute('aria-expanded','false');
        el.setAttribute('aria-label','Open: ' + it.label);

        const listHTML = toListHTML(it.body);

        el.innerHTML = `
          <span class="label">${it.label}</span>
          <div class="card" role="group" aria-modal="false">
            ${listHTML}
          </div>`;
        return el;
      }

      function setOpen(el,on){
        el.classList.toggle('is-open', on);
        el.setAttribute('aria-expanded', on ? 'true' : 'false');
      }

      function bindInteractions(boxes){
        boxes.forEach(el=>{
          const pinned = () => el.dataset.pinned === '1';
          const pin = v => v ? el.dataset.pinned='1' : delete el.dataset.pinned;

          const mq = matchMedia('(hover: hover)');
          if (mq.matches){
            el.addEventListener('mouseenter', ()=>{ if(!pinned()) setOpen(el,true); });
            el.addEventListener('mouseleave', ()=>{ if(!pinned()) setOpen(el,false); });
          }
          el.addEventListener('click', e=>{
            e.stopPropagation();
            const was = pinned();
            boxes.forEach(b=>{ delete b.dataset.pinned; setOpen(b,false); });
            if (!was){ pin(true); setOpen(el,true); }
          });
          el.addEventListener('keydown', e=>{
            if (e.key==='Enter' || e.key===' '){ e.preventDefault(); el.click(); }
            if (e.key==='Escape'){ pin(false); setOpen(el,false); }
          });
        });

        sec.addEventListener('click', e=>{
          if (!e.target.closest('.hbox')){
            boxes.forEach(b=>{ delete b.dataset.pinned; setOpen(b,false); });
          }
        });
      }

      function render(){
        scatter.innerHTML = '';
        const items = LUX_LAYOUT ? applyLuxLayout([...DATA]) : DATA;
        const boxes = items.map(it => {
          const el = buildBox(it);
          scatter.appendChild(el);
          return el;
        });
        bindInteractions(boxes);
      }

      function safeRender(){ try { render(); } catch(e){ console.error('Ways-We-Work init error:', e); } }

      if (document.readyState === 'loading'){
        document.addEventListener('DOMContentLoaded', ()=> requestAnimationFrame(safeRender));
      } else {
        requestAnimationFrame(safeRender);
      }

      /* === Removed: virtual scroll handlers for wheel/touch/keyboard === */
    })();
  </script>

  <!-- === TRANSITION CONTROLLER to Section 7 (added) === -->
  <script>
    (function(){
      const sec = document.getElementById('ways-we-work');
      
      let transitioning = false;
      let touchStartY = 0;
      let handedOff = false; // <-- NEW: run the sweep only once


      



      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const EXIT_DURATION = prefersReduced ? 350 : 950;  // ms
      const MIDPOINT = prefersReduced ? 150 : 450;        // ms

      function isScrollDownIntent(evt){
        // Wheel / touchpad
        if ('deltaY' in evt) return evt.deltaY > 0;
        // Keyboard
        if (evt.type === 'keydown'){
          const k = evt.key;
          if (k === 'PageDown' || k === 'End' || k === 'ArrowDown') return true;
          if (k === ' ' && !evt.shiftKey) return true;
          return false;
        }
        // Touch handled separately
        return false;
      }

      function prevent(e){ e.preventDefault(); e.stopPropagation(); }

      function startExit(){
  if (transitioning || handedOff) return;
  transitioning = true;
  handedOff = true;

  // ➊ trigger the CSS sweep (adds .is-exiting so boxes fly out)
  sec.classList.add('is-exiting');

  function handoffToS7(){
  // Try parent (if you have an outer controller)
  try { parent.postMessage({ type:'elysian:go-next', from:'s6' }, location.origin); } catch(_) {}

  // Local fallback: switch to S7 yourself
  document.documentElement.classList.add('phase-s7');
  const cta = document.getElementById('cta');
  if (cta) cta.classList.add('is-active');
  document.dispatchEvent(new CustomEvent('sectionchange', { detail: { id:'s7', from:'s6' }}));
  document.body.style.overflow = 'hidden';
}

  window.setTimeout(handoffToS7, MIDPOINT);

  // ➌ cleanup after the sweep finishes
  window.setTimeout(()=>{
    transitioning = false;
    sec.classList.remove('is-exiting');
    const done = new CustomEvent('sectionSweepComplete', { detail: { id: 's7', from: 's6' }});
    document.dispatchEvent(done);
  }, EXIT_DURATION);
}



      /* ==== INPUT HOOKS (wheel/touchpad/touch/keyboard) ==== */

      // Wheel & touchpad
      function onWheel(e){
        if (transitioning) { prevent(e); return; }
        // Only intercept if user intends to go DOWN and we're in S6 viewport
        const inView = isSectionInView();
        if (inView && e.deltaY > 0){
          prevent(e);
          startExit();
        }
      }

      // Keyboard
      function onKey(e){
        if (transitioning) { prevent(e); return; }
        const inView = isSectionInView();
        if (!inView) return;
        if (isScrollDownIntent(e)){
          prevent(e);
          startExit();
        }
      }

      // Touch
      function onTouchStart(e){ touchStartY = e.changedTouches[0].clientY; }
      function onTouchMove(e){
        if (transitioning) { prevent(e); return; }
        const inView = isSectionInView();
        if (!inView) return;
        const dy = touchStartY - e.changedTouches[0].clientY; // swipe up = positive
        if (dy > 24){ // small threshold
          prevent(e);
          startExit();
        }
      }

     function isSectionInView(){
  if (document.documentElement.classList.contains('phase-s7')) return false;
  if (handedOff) return false;

  const r = sec.getBoundingClientRect();
  const mid = (window.innerHeight || document.documentElement.clientHeight) / 2;
  // true if the section spans across the viewport center
  return r.top <= mid && r.bottom >= mid;
}



      // Attach listeners at capture phase so we can prevent early
      window.addEventListener('wheel', onWheel, { passive:false, capture:true });
      window.addEventListener('keydown', onKey, { capture:true });
      window.addEventListener('touchstart', onTouchStart, { passive:true, capture:true });
      window.addEventListener('touchmove', onTouchMove, { passive:false, capture:true });

      // Cleanup on unload
      window.addEventListener('pagehide', ()=>{
        window.removeEventListener('wheel', onWheel, { capture:true });
        window.removeEventListener('keydown', onKey, { capture:true });
        window.removeEventListener('touchstart', onTouchStart, { capture:true });
        window.removeEventListener('touchmove', onTouchMove, { capture:true });
      });

     document.addEventListener('sectionchange', (e)=>{
  if (e?.detail?.id !== 's6') return;
  handedOff = false;

  // Make it slower so you can *see* the return
  sec.style.setProperty('--ret-dur', '2400ms');

  // 1) apply the off-screen pose
  sec.classList.add('is-exiting');

  // 2) FORCE the browser to commit that pose (layout flush)
  void sec.offsetWidth; // or: sec.getBoundingClientRect();

  // 3) then animate back in
  requestAnimationFrame(()=>{
    sec.classList.remove('is-exiting');
  });
});


    })();

   
  </script>
  <script>
/* Make the "WRITINGS" and "INSTRUMENTS" links in S6
   behave like the top nav (client-side route, no reload). */
(function () {
  const sec = document.getElementById('ways-we-work');

  // Safety: if S6 isn't on the page, stop.
  if (!sec) return;

  sec.addEventListener('click', function (e) {
    const a = e.target.closest('a.inline-cta[href]');
    if (!a) return;

    // Let normal “open in new tab” work
    if (e.metaKey || e.ctrlKey || e.shiftKey || e.button === 1) return;

    const href = a.getAttribute('href') || '';
    const isInternal = href.startsWith('/');

    if (!isInternal) return; // external links = let browser handle

    // Stop the browser doing a full reload:
    e.preventDefault();

    // 1) If you have a nav/router function, call it here (optional):
    // if (window.appNavigate) { window.appNavigate(href); return; }

    // 2) Otherwise mimic your CTA code: pushState + fire popstate
    try {
      history.pushState({}, '', href);
      // Tell your SPA “route changed” (same pattern you already use in S7 code)
      window.dispatchEvent(new Event('popstate'));
    } catch (_) {
      // Worst case, just go there normally
      location.assign(href);
    }
  });
})();
</script>

</section>


<section id="cta" class="s68" aria-label="Get Clarity CTA" tabindex="0">

  <style>
html.phase-s7 #ways-we-work { visibility:hidden; pointer-events:none; }

/* ------------------------------ Local fonts ------------------------------ */
    @font-face { font-family:'Eyesome';  src:url('./Fonts/Eyesome-Regular.otf') format('opentype'); font-display:swap; }
    @font-face { font-family:'EyesomeI'; src:url('./Fonts/Eyesome-Italic.otf')  format('opentype'); font-display:swap; }
    @font-face { font-family:'cotorisi'; src:url('./Fonts/cotorisita.otf')      format('opentype'); font-weight:400; font-style:normal; font-display:swap; }

    html.phase-s7 #ways-we-work { visibility:hidden; }

    /* ============================== CTA Root Vars ============================ */
    #cta{

      /* PARK S7 INITIALLY (so it doesn't yank the viewport) */
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100svh;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transform: translateY(6px);
      filter: blur(1px);
      transition:
        opacity 560ms cubic-bezier(.22,.61,.36,1),
        transform 560ms cubic-bezier(.22,.61,.36,1),
        filter   560ms cubic-bezier(.22,.61,.36,1);


      /* Palette */
      --bg:transparent;
      --ink:#13294b;
      --panel:#fffcf8;
      --hair:#fffcf8;        /* hairlines / borders */
      --muted:#6b655c;       /* labels / subtle text */
      --focus:#b4ab9d;       /* focus & hover border */
      --chrome:#3b3731;      /* small icons / chevrons */
      --danger:#b3261e;

      /* Field palette */
      --label:#5b554d;       /* “Your name”, “Email”, etc. */
      --field-bg:#ffffff;    /* input / textarea / select bg */
      --field-ink:#13294b;   /* input / textarea / select text */
      --field-border:#c9c2b6;
      --field-focus:#b4ab9d;
      --placeholder:#9a938a;

      /* Chip (choice buttons) */
      --chip-bg:          color-mix(in oklab, #fff 95%, #000 5%);
      --chip-bg-hover:    color-mix(in oklab, #fff 95%, #faf7f2 5%);
      --chip-ink:         #1a1a1a;
      --chip-border:      var(--hair);
      --chip-checked-bg:  var(--ink);
      --chip-checked-ink: #fff;

      /* Typography families & sizes */
      --ff-display:'Eyesome', serif;
      --ff-ui: cotorisi, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --fs-title: clamp(20px, 2.5vw, 32px);
      --fs-label: 12.5px;
      --fs-input: 15px;
      --fs-textarea: 15px;
      --fs-chip: 12px;
      --fs-btn: clamp(16px, 1.8vw, 21px);
      --fs-quote: clamp(18px, 4vw, 28px);
      --fs-pop: clamp(15px, 1.6vw, 18px);
      --fs-kicker: clamp(12px,1.2vw,13px);

      /* Spacing & motion */
      --pad: clamp(18px, 4vw, 44px);
      --radius: 18px;
      --curve: cubic-bezier(.22,.61,.36,1);
      --t: 520ms; --t-fast: 220ms;

      /* Pop transitions */
      --t-pop: 380ms; --ease-pop: cubic-bezier(.22,.61,.36,1);

      /* Dock (bottom buttons) */
      --btn-gap: clamp(30px, 6vw, 70px);
      --dock-bottom: clamp(14px, 4.2vh, 34px);
      --dock-left: 50%;
      --dock-translate: -50%;
      --dock-justify: center;

      /* Fit one screen */
      --dock-gap: clamp(56px, 8.5vh, 72px);
      --dock-gap-open: clamp(52px, 8vh, 66px);
      --form-clear: clamp(12px, 1.6vh, 18px);

      /* Grid columns */
      --left-col: 0fr;            /* hidden until form opens */
      --left-col-open: 1.55fr;    /* visible width when open */
      --right-col: 1fr;

      /* POP LAYOUT (top squeeze) */
      --pop-space: clamp(160px, 26vh, 300px);
      --dim-amt: .38;

      /* Entrance timing */
      --enter-t: 520ms;
      --enter-ease: cubic-bezier(.22,.61,.36,1);
      --stagger: 38ms;

      /* Quote animation controls */
      --quote-delay: 2500;         /* ms before quote starts shrinking */
      --quote-dur: 900;           /* ms shrink duration */
      --quote-ease: cubic-bezier(.22,.61,.36,1);
      --q-start: 2;             /* initial scale */
      --q-end:   1.1;             /* final scale */

      position:relative; display:block;
      height:100svh; min-height:100svh; max-height:100svh;
      overflow:hidden; background:var(--bg); color:var(--ink);
      -webkit-tap-highlight-color:transparent;
    }
    
    /* REVEAL S7 WHEN ACTIVE */
    #cta.is-active{
      opacity: 1;
      position: fixed;
      inset: 0;
      width: 100vw; height: 100svh; max-height: 100svh;
      z-index: 9999;
      pointer-events: auto;
      transform: none;
      filter: none;
    }
    /* --- Instant-open helper (no animations for this paint) --- */
#cta.instant *{ transition: none !important; }
#cta.instant .form-card{
  clip-path: inset(0 0 0 0 round 22px);
  transform: none;
  opacity: 1;
}

    
    #cta.show-form{ --dock-gap: var(--dock-gap-open); }
    #cta *{ box-sizing:border-box; }

    /* Soft vignette */
    #cta::before{
      content:""; position:absolute; inset:-20%;
      background:
        radial-gradient(1200px 600px at 50% 110%, rgba(0,0,0,.08), transparent 60%),
        linear-gradient(to top, rgba(255,255,255,.18), transparent 30%);
      pointer-events:none; mix-blend-mode:multiply; opacity:.22;
    }
   
    #cta { --q-nudge: 38px; }

    /* ============================== Stage / Grid ============================= */
    #cta .panel{
      position:relative; height:100%; max-height:100%;
      padding: var(--pad);
      padding-bottom: calc(var(--dock-gap) + var(--form-clear));
      display:grid;
      grid-template-columns: var(--left-col) var(--right-col);
      gap: clamp(18px, 3.4vw, 40px);
      align-content:center; align-items:center; justify-content:center;
      max-width:1360px; margin:0 auto; width:100%;
      transition:
        grid-template-columns var(--t) var(--curve),
        padding-bottom var(--t) var(--curve),
        transform var(--t) var(--curve);
      overflow:hidden;
    }

    /* Squeeze when popover shows */
    #cta.show-form.pop-open .panel{
      padding-bottom: calc(var(--dock-gap) + var(--form-clear) + var(--pop-space));
      transform: translateY(calc(var(--pop-space) * -0.10));
    }

    /* =============================== Form Card ============================== */
    #cta .form-card{
      background: var(--panel);
      border:1px solid color-mix(in oklab, var(--hair) 85%, #000 15%);
      border-radius: calc(var(--radius) + 2px);
      box-shadow:
        0 0 0 1px rgba(0,0,0,.03),
        0 10px 22px rgba(0,0,0,.08),
        0 2px 6px rgba(0,0,0,.04);
      padding: clamp(14px, 2.2vw, 24px) clamp(14px, 2.2vw, 24px) clamp(10px, 1.6vw, 14px);

      /* buttery entrance */
      clip-path: inset(6% 6% 10% 6% round 22px);
      transform: translateY(8px) scale(.992);
      opacity: 0;
      pointer-events: none;

      transition:
        clip-path var(--enter-t) var(--enter-ease),
        transform var(--enter-t) var(--enter-ease),
        opacity   var(--enter-t) var(--enter-ease),
        max-height var(--t) var(--curve);

      height: calc(100svh - var(--pad)*2 - calc(var(--dock-gap) + var(--form-clear)));
      max-height: calc(100svh - var(--pad)*2 - calc(var(--dock-gap) + var(--form-clear)));
      display:flex; flex-direction:column; justify-content:flex-start;
      overflow:hidden;
    }
    #cta.show-form .form-card{
      clip-path: inset(0 0 0 0 round 22px);
      transform: none;
      opacity: 1;
      pointer-events: auto;
    }
    #cta.show-form.pop-open .form-card{
      max-height: calc(100svh - var(--pad)*2 - calc(var(--dock-gap) + var(--form-clear)) - var(--pop-space));
    }

    #cta .form-card h3{
      margin: 0 0 10px; padding: 0 0 10px; border-bottom: 1px solid var(--hair);
      font-family: 'EyesomeI'; font-size: 25px; font-weight: 400; letter-spacing:-.01em; flex:0 0 auto;
    }

    /* =============================== Form Grid ============================== */
    #cta .form{ display:grid; gap:10px; flex:1 0 auto; }
    #cta .row{ display:grid; grid-template-columns: 0.7fr 1.2fr; gap:10px; }
    #cta .row.row-3{ grid-template-columns: 1fr 1fr 1fr; }

    @media (max-width: 900px){
      #cta .row{ grid-template-columns:1fr; }
      #cta .row.row-3{ grid-template-columns:1fr; }
      #cta .panel{ grid-template-columns: var(--left-col) 1fr; }
      #cta .form-card{ height: calc(100svh - var(--pad)*2 - calc(var(--dock-gap) + var(--form-clear))); }
      #cta .quote{ order: 2; }
    }

    /* Labels */
    #cta .form label{
      display:block; margin-bottom:4px;
      color: var(--label);
      font:600 var(--fs-label)/1.2 var(--ff-ui);
      letter-spacing:.02em;
    }
    #cta label.req::after{ content:" *"; color:var(--danger); font-weight:700; }

    /* Inputs & textarea */
    #cta .form input[type="text"],
    #cta .form input[type="email"],
    #cta .form textarea{
      width:100%;
      border:1px solid var(--field-border);
      border-radius:12px;
      background: var(--field-bg);
      color: var(--field-ink);
      padding:10px 12px;
      font:500 var(--fs-input)/1.45 var(--ff-ui);
      outline:none;
      transition: border-color var(--t-fast) var(--curve), box-shadow var(--t-fast) var(--curve), transform var(--t-fast) var(--curve);
    }
    #cta .form textarea{ min-height:92px; max-height:22vh; resize:vertical; font-size: var(--fs-textarea); }
    #cta .form input:focus,
    #cta .form textarea:focus{
      border-color: var(--field-focus);
      box-shadow: 0 12px 30px rgba(0,0,0,.10);
      transform: translateY(-1px);
    }
    #cta .form input::placeholder,
    #cta .form textarea::placeholder{
      color: var(--placeholder);
      opacity: 1;
    }

    /* Invalid highlight */
    #cta .is-invalid{
      border-color: var(--danger) !important;
      box-shadow: 0 10px 24px rgba(179,38,30,.10) !important;
    }

    /* Chips (multi/radio) */
    #cta .choices{ display:flex; flex-wrap:wrap; gap:10px; }
    #cta .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 14px; min-height:38px;
      border:1px solid var(--chip-border);
      border-radius:999px;
      background: var(--chip-bg);
      color: var(--chip-ink);
      font:600 var(--fs-chip)/1 var(--ff-ui);
      cursor:pointer; user-select:none;
      transition: transform var(--t-fast) var(--curve), box-shadow var(--t-fast) var(--curve), background var(--t-fast) var(--curve);
    }
    #cta .chip:hover{ transform: translateY(-1px); box-shadow: 0 10px 28px rgba(0,0,0,.08); background: var(--chip-bg-hover); }
    #cta .chip[data-checked="true"]{ background: var(--chip-checked-bg); color: var(--chip-checked-ink); border-color: var(--chip-checked-bg); }
    #cta .chip:focus-visible{ outline: 2px solid color-mix(in oklab, var(--focus) 80%, #000 20%); outline-offset: 2px; }

    /* Submit area */
    #cta .submit{ display:flex; align-items:flex-start; gap:10px; }
    #cta .btn-primary{
      height:44px; padding:0 16px; border-radius:12px; border:1px solid var(--hair); background:#fff; color:#13294b;
      font:700 14px/1 var(--ff-ui); cursor:pointer; box-shadow: 0 10px 22px rgba(0,0,0,.12);
      transition: transform var(--t-fast) var(--curve), box-shadow var(--t-fast) var(--curve);
    }
    #cta .btn-primary:hover{ transform: translateY(-1px); }

    #cta #form-hint.hint{
      color: var(--danger);
      font:600 12.5px/1.25 var(--ff-ui);
      opacity:0; transition: opacity var(--t-fast) var(--curve);
    }
    #cta #form-hint.hint[aria-hidden="false"]{ opacity:1; }

    #cta #form-note.note{
      margin-left:auto; color: var(--muted);
      font:500 12.5px/1.25 var(--ff-ui);
      max-width: 56ch; text-align:right; margin-top: 4px;
    }

    /* ============================ Quote: big→small ============================ */
    #cta .quote{
      position:relative; display:flex; align-items:center; justify-content:center;
      padding: clamp(6px, 1.6vw, 14px);
      color:#13294b; text-align:center; min-height: 120px;
      max-width: 48ch; margin-inline:auto;
      font-family: 'cotorisi';
      overflow:hidden;

      transform: translateX(0) scale(var(--q-start));
  transform-origin: center;
  will-change: transform;
  transition:
    transform calc(var(--quote-dur)*1ms) var(--quote-ease),
    opacity var(--t-fast) var(--curve);
    }
    #cta .quote::before{
      content:"“"; position:absolute; inset:auto auto 100% 50%; transform: translate(-50%, 18%);
      font-family: var(--ff-display); font-size: clamp(42px, 5.2vw, 72px); line-height:1; color:#000; opacity:.10; filter: blur(.3px);
    }
    #cta .quote::after{
      content:""; position:absolute; left:50%; bottom:-8px; width:120px; height:1px; transform: translateX(-50%);
      background: linear-gradient(90deg, transparent, rgba(0,0,0,.55), transparent); opacity:.65;
    }
    /* JS adds this to trigger the shrink */
    #cta .quote.is-shrinking{ transform: translateX(var(--q-nudge)) scale(var(--q-end)); }

    /* Selective dim when popover shown */
    #cta.pop-open .panel > :not(.quote){
      opacity: var(--dim-amt);
      filter: saturate(.9) blur(.1px);
      transition: opacity var(--t-fast) var(--curve), filter var(--t-fast) var(--curve);
    }

    /* ================================ Dock ================================== */
    #cta .dock{
      position:absolute; left: var(--dock-left); bottom: var(--dock-bottom);
      transform: translateX(var(--dock-translate)) translateY(8px);
      opacity: 0; pointer-events: none;

      display:flex; justify-content: var(--dock-justify); gap: var(--btn-gap);
      padding:0; background:none; border:0; z-index:300;
      flex-wrap: nowrap; white-space: nowrap;
      overflow-x: auto; overflow-y: visible;
      -webkit-overflow-scrolling: touch; scrollbar-width: none;

      transition: opacity 380ms var(--enter-ease), transform 380ms var(--enter-ease);
    }
    #cta .dock::-webkit-scrollbar{ display:none; }
    #cta .cta-btn{
      position:relative; display:inline-flex; align-items:center; justify-content:center;
      background:transparent; border:none; padding:6px 2px;
      color:#14110e; cursor:pointer; letter-spacing:.20em; text-transform:uppercase;
      font-family: 'EyesomeI'; font-weight: 600;
      transition: transform var(--t-fast) var(--curve), opacity var(--t-fast) var(--curve);
      will-change: transform; z-index: 310; outline: none;
    }
    #cta .cta-btn:hover, #cta .cta-btn:focus-visible{ transform: translateY(-0.5px); }
    #cta .cta-btn.is-active{ opacity:.98; }

    /* new: dock is visible whenever S7 is active */
#cta.is-active .dock{
  transform: translateX(var(--dock-translate)) translateY(0);
  opacity: 1;
  pointer-events: auto;
}


    /* Floating Popover */
    #cta .pop-layer{ position:absolute; inset:0; pointer-events:none; z-index:1100; }
    /* --- Restore popover actions styling --- */
#cta .pop .actions{
  display:flex; gap:14px; justify-content:center; margin-top:8px;
}
#cta .pop .act-link{
  display:inline-flex; align-items:center; justify-content:center;
  min-width:132px; height:36px; padding:0 18px; border-radius:999px;
  border:1px solid color-mix(in oklab, var(--hair) 80%, #000 20%);
  background:#fff; color:#13294b; cursor:pointer; user-select:none;
  font:700 12px/1 var(--ff-ui); letter-spacing:.12em; text-transform:uppercase;
  font-style: italic; text-decoration: none; text-underline-offset: 3px;
  text-decoration-thickness: 1px;
  text-decoration-color: color-mix(in oklab, currentColor 60%, transparent);
  transition: transform var(--t-fast) var(--curve), box-shadow var(--t-fast) var(--curve), text-decoration-color var(--t-fast) var(--curve);
}
#cta .pop .act-link:hover,
#cta .pop .act-link:focus-visible{
  transform: translateY(-1px);
  box-shadow: 0 12px 28px rgba(0,0,0,.12);
  text-decoration-color: currentColor;
}

/* --- Restore the little arrow tip --- */
#cta .pop::after{
  content:""; position:absolute; width:12px; height:12px; background:#fff;
  border-left:1px solid color-mix(in oklab, var(--hair) 85%, #000 15%);
  border-top:1px solid color-mix(in oklab, var(--hair) 85%, #000 15%);
  transform: rotate(45deg); left: calc(50% - 6px);
}
#cta .pop[data-pos="above"]::after{ bottom:-7px; box-shadow: 2px 2px 8px rgba(0,0,0,.08); }
#cta .pop[data-pos="below"]::after{ top:-7px; transform: rotate(225deg); box-shadow: -2px -2px 8px rgba(0,0,0,.08); }

        
    #cta .pop{
      position:absolute; display:none; pointer-events:auto;
      max-width:min(78vw, 650px);
      background:#fffcf8; color:#13294b;
      border:1px solid color-mix(in oklab, var(--hair) 85%, #000 15%);
      border-radius:14px; box-shadow: 0 24px 80px rgba(0,0,0,.18);
      padding:14px 16px;
      font:500 var(--fs-pop)/1.6 var(--ff-ui);
      opacity:0; transform: translateY(10px) scale(.985); filter: blur(2px);
      transition: opacity var(--t-pop) var(--ease-pop), transform var(--t-pop) var(--ease-pop), filter var(--t-pop) var(--ease-pop);
      will-change: opacity, transform, filter;
    }
    #cta .pop[data-show="true"]{ display:block; }
    #cta .pop[data-animate="in"]{ opacity:1; transform:none; filter:none; }
    #cta .pop .kicker{ display:block; letter-spacing:.18em; text-transform:uppercase; font:700 var(--fs-kicker)/1 var(--ff-ui); opacity:.8; margin-bottom:6px; }
    #cta .pop ul{ list-style:none; margin:0 0 10px 0; padding:0; }
    #cta .pop li{ margin:.36rem 0; }
    #cta .pop li::before{ content:'✧'; opacity:.65; margin-right:.25em; }

    /* Modal */
    #cta .modal{ position:fixed; inset:0; display:grid; place-items:center; background: rgba(10,10,10,.46);
      opacity:0; pointer-events:none; transition: opacity var(--t) var(--curve); z-index:2000; }
    #cta .modal[aria-hidden="false"]{ opacity:1; pointer-events:auto; }
    #cta .modal__card{ width:min(560px, 92vw); background:#fff; color:#13294b; border-radius:20px; border:1px solid var(--hair); padding:22px; box-shadow: 0 44px 120px rgba(0,0,0,.28); }
    #cta .modal__card h4{ margin:0 0 8px; font-family: var(--ff-display); font-size: clamp(20px, 2.2vw, 26px); }
    #cta .modal__card p{ margin:0 0 12px; font:500 15px/1.6 var(--ff-ui); color:#2b2925; }
    #cta .modal__actions{ display:flex; justify-content:flex-end; gap:10px; }
    #cta .btn-ghost{ height:42px; padding:0 14px; border-radius:10px; border:1px solid var(--hair); background:#fffcf8; cursor:pointer; font:700 14px/1 var(--ff-ui); }

    @media (max-height: 760px){
      #cta .form textarea{ min-height:84px; }
      #cta .btn-primary{ height:42px; }
      #cta .quote{ font-size: clamp(16px, 4vw, 24px); }
    }
    @media (prefers-reduced-motion: reduce){
      #cta *{ transition:none !important; }
      #cta .form-card{ clip-path:none !important; transform:none !important; opacity:1 !important; }
      #cta .quote{ transform:none !important; }
      #cta .dock{ transform: translateX(var(--dock-translate)) !important; opacity:1 !important; }
    }

    /* ========================= Fancy Selects (Role/When/Country) ========================= */
    .fselect{ position:relative; }
    .fselect .fs-button{
      width:100%; display:flex; align-items:center; justify-content:space-between; gap:12px;
      background: var(--field-bg);
      border:1px solid var(--field-border);
      border-radius:12px; padding:10px 12px;
      font:500 var(--fs-input)/1.45 var(--ff-ui);
      color: var(--field-ink);
      cursor:pointer; user-select:none;
      box-shadow: 0 1px 0 rgba(255,255,255,.4) inset, 0 6px 16px rgba(0,0,0,.06);
      transition: border-color var(--t-fast) var(--curve), box-shadow var(--t-fast) var(--curve), transform var(--t-fast) var(--curve), background var(--t-fast) var(--curve);
    }
    .fselect .fs-button:hover{ transform: translateY(-1px); box-shadow: 0 12px 28px rgba(0,0,0,.08); }
    .fselect[aria-expanded="true"] .fs-button{ border-color: var(--field-focus); }
    .fselect .fs-placeholder{ color: var(--placeholder); }
    .fselect .fs-value{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .fselect .fs-chevron{ flex:0 0 auto; width:18px; height:18px; position:relative; }
    .fselect .fs-chevron::before, .fselect .fs-chevron::after{
      content:""; position:absolute; inset:0; margin:auto; width:10px; height:10px;
      border-right:2px solid var(--chrome); border-bottom:2px solid var(--chrome);
      transform: rotate(45deg) translateY(-1px); opacity:.66;
      transition: transform var(--t-fast) var(--curve), opacity var(--t-fast) var(--curve);
    }
    .fselect[aria-expanded="true"] .fs-chevron::before{ transform: rotate(-135deg) translateY(1px); opacity:.9; }

    .fselect .fs-pop{
      position:absolute; left:0; right:0; top: calc(100% + 8px); z-index: 500;
      background: rgba(255,255,255,.85);
      -webkit-backdrop-filter: saturate(1.1) blur(6px); backdrop-filter: saturate(1.1) blur(6px);
      border:1px solid color-mix(in oklab, var(--hair) 85%, #000 15%);
      border-radius:14px; box-shadow: 0 26px 80px rgba(0,0,0,.18), 0 1px 0 rgba(255,255,255,.35) inset;
      overflow:hidden; display:none;
      opacity:0; transform: translateY(6px) scale(.985); filter: blur(1.5px);
      transition: opacity var(--t-pop) var(--ease-pop), transform var(--t-pop) var(--ease-pop), filter var(--t-pop) var(--ease-pop);
    }
    .fselect .fs-pop[data-show="true"]{ display:block; }
    .fselect .fs-pop[data-animate="in"]{ opacity:1; transform:none; filter:none; }

    .fselect .fs-list{ list-style:none; margin:0; padding:6px; max-height:220px; overflow:auto; }
    .fselect .fs-option{
      display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:10px; cursor:pointer;
      font:500 var(--fs-input)/1.35 var(--ff-ui); color:#23201a; letter-spacing:.01em;
      transition: background var(--t-fast) var(--curve), transform var(--t-fast) var(--curve);
    }
    .fselect .fs-option[aria-selected="true"]{ background: color-mix(in oklab, var(--ink) 8%, var(--panel) 92%); }
    .fselect .fs-option:hover{ background: color-mix(in oklab, var(--ink) 6%, var(--panel) 94%); transform: translateY(-0.5px); }
    .fselect .fs-check{
      width:14px; height:14px; border-radius:3px; border:1px solid color-mix(in oklab, var(--hair) 80%, #000 20%);
      display:inline-block; position:relative; flex:0 0 auto; background: var(--panel);
    }
    .fselect .fs-option[aria-selected="true"] .fs-check{ background: var(--ink); border-color: var(--ink); }
    .fselect .fs-option[aria-selected="true"] .fs-check::after{
      content:""; position:absolute; left:3px; top:0px; width:6px; height:10px; border-right:2px solid #fff; border-bottom:2px solid #fff; transform: rotate(45deg);
    }

    .native-hidden{ display:none !important; }
    #cta .form-card:has(.fselect[aria-expanded="true"]){ overflow: visible; }
    #cta .form label + .choices{ margin-top: 8px; }
    .fselect[data-pos="above"] .fs-pop{ top:auto; bottom: calc(100% + 8px); }
    .fselect .fs-search{
      width: calc(100% - 12px); margin: 8px 6px 4px; padding: 8px 10px;
      border:1px solid var(--hair); border-radius:10px; font:500 var(--fs-input)/1.35 var(--ff-ui);
      outline:none; transition: border-color var(--t-fast) var(--curve), box-shadow var(--t-fast) var(--curve);
      background:#fffcf8;
    }
    .fselect .fs-search:focus{ border-color: var(--focus); box-shadow:0 10px 24px rgba(0,0,0,.08); }
    .fselect .fs-pop .fs-list{ max-height: 280px; }
    .fselect .fs-pop{ top: calc(100% + 8px) !important; bottom: auto !important; }
    .fselect[data-pos="above"] .fs-pop{ top: calc(100% + 8px) !important; bottom: auto !important; }
  </style>

  <div class="panel" role="group" aria-label="CTA Panel">
    <div class="form-card">
      <h3>Get Clarity</h3>
      <form class="form" id="cta-form" novalidate
            action="https://formspree.io/f/xwpnddnl"
            method="POST">
        <input type="hidden" name="_subject" value="New inquiry — Elysian Advisory">
        <input type="hidden" name="_origin"  value="CTA form on elysianclarity.com">

        <div class="row">
          <div>
            <label for="name" class="req">Your name</label>
            <input id="name" name="name" type="text" autocomplete="name" required />
          </div>
          <div>
            <label for="email" class="req">Email</label>
            <input id="email" name="email" type="email" autocomplete="email" required />
          </div>
        </div>

        <input type="hidden" name="g-recaptcha-response" id="g-recaptcha-response">

        <div class="row">
          <div>
            <label for="role">Role</label>
            <select id="role" class="native-hidden" disabled>
              <option value="" disabled selected>Select one</option>
              <option>Founder</option>
              <option>CEO</option>
              <option>Operator</option>
              <option>Solo Strategist</option>
              <option>Other</option>
            </select>
            <input type="hidden" name="role" id="role_value" />
            <div class="fselect" data-for="role_value" aria-haspopup="listbox" aria-expanded="false">
              <button type="button" class="fs-button" aria-label="Choose role" aria-controls="fs-role-list" aria-expanded="false">
                <span class="fs-value fs-placeholder">Select one</span>
                <span class="fs-chevron" aria-hidden="true"></span>
              </button>
              <div class="fs-pop" id="fs-role-pop">
                <ul class="fs-list" id="fs-role-list" role="listbox" aria-label="Role options">
                  <li class="fs-option" role="option" data-value="Founder"         tabindex="-1"><span class="fs-check"></span>Founder</li>
                  <li class="fs-option" role="option" data-value="CEO"              tabindex="-1"><span class="fs-check"></span>CEO</li>
                  <li class="fs-option" role="option" data-value="Operator"         tabindex="-1"><span class="fs-check"></span>Operator</li>
                  <li class="fs-option" role="option" data-value="Solo Strategist"  tabindex="-1"><span class="fs-check"></span>Solo Strategist</li>
                  <li class="fs-option" role="option" data-value="Other"            tabindex="-1"><span class="fs-check"></span>Other</li>
                </ul>
              </div>
            </div>
          </div>

          <div>
            <label>Engagement</label>
            <div class="choices" role="group" aria-label="Engagement type">
              <button type="button" class="chip" data-value="Audit">Clarity Session</button>
              <button type="button" class="chip" data-value="Sprint">Project-Wise Engagement</button>
              <button type="button" class="chip" data-value="Retainer">Ongoing Partnership</button>
            </div>
            <input type="hidden" name="engagement" id="engagement" />
          </div>
        </div>

        <div class="row row-3">
          <div>
            <label>Preferred channel</label>
            <div class="choices" role="radiogroup" aria-label="Preferred channel">
              <button type="button" class="chip" data-radio="channel" data-value="Phone">Phone</button>
              <button type="button" class="chip" data-radio="channel" data-value="Video">Video</button>
              <button type="button" class="chip" data-radio="channel" data-value="Email">Email</button>
            </div>
            <input type="hidden" name="channel" id="channel" />
          </div>

          <p style="position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden;">
            <label>Leave this field empty
              <input type="text" name="_gotcha" tabindex="-1" autocomplete="off">
            </label>
          </p>

          <div>
            <label for="when">Ideal timeframe</label>
            <select id="when" class="native-hidden" disabled>
              <option>ASAP</option>
              <option>This week</option>
              <option>Within 2 weeks</option>
              <option>This month</option>
            </select>
            <input type="hidden" name="when" id="when_value" />
            <div class="fselect" data-for="when_value" aria-haspopup="listbox" aria-expanded="false">
              <button type="button" class="fs-button" aria-label="Choose timeframe" aria-controls="fs-when-list" aria-expanded="false">
                <span class="fs-value fs-placeholder">Choose timeframe</span>
                <span class="fs-chevron" aria-hidden="true"></span>
              </button>
              <div class="fs-pop" id="fs-when-pop">
                <ul class="fs-list" id="fs-when-list" role="listbox" aria-label="Ideal timeframe">
                  <li class="fs-option" role="option" data-value="ASAP"           tabindex="-1"><span class="fs-check"></span>ASAP</li>
                  <li class="fs-option" role="option" data-value="This week"      tabindex="-1"><span class="fs-check"></span>This week</li>
                  <li class="fs-option" role="option" data-value="Within 2 weeks" tabindex="-1"><span class="fs-check"></span>Within 2 weeks</li>
                  <li class="fs-option" role="option" data-value="This month"     tabindex="-1"><span class="fs-check"></span>This month</li>
                </ul>
              </div>
            </div>
          </div>

          <div>
            <label for="country_value">Reaching from</label>
            <input type="hidden" name="country" id="country_value" />
            <div class="fselect" data-for="country_value" data-search="true" aria-haspopup="listbox" aria-expanded="false">
              <button type="button" class="fs-button" aria-label="Choose country" aria-controls="fs-country-list" aria-expanded="false">
                <span class="fs-value fs-placeholder">Select country</span>
                <span class="fs-chevron" aria-hidden="true"></span>
              </button>
              <div class="fs-pop" id="fs-country-pop">
                <input type="text" class="fs-search" placeholder="Type to filter…" aria-label="Search countries" />
                <ul class="fs-list" id="fs-country-list" role="listbox" aria-label="Country options"></ul>
              </div>
            </div>
          </div>
        </div>

        <div>
          <label for="message" class="req">Context / Aim</label>
          <textarea id="message" name="message" placeholder="Tell us where clarity would move the needle…" required></textarea>
        </div>

        <div class="submit">
          <button class="btn-primary" type="submit">Seek Clarity</button>
          <span id="form-hint" class="hint" aria-live="polite" aria-hidden="true"></span>
          <span id="form-note" class="note">Clarity demands honesty — <br> your details are received in confidence, used solely to connect.</span>
        </div>
      </form>
    </div>

    <aside class="quote" role="note">
      “The truth is always there. <br>You just need someone
      brutal enough to show it,<br>and calm enough to map what’s next.
      <br>That’s Clarity. That’s Elysian.”
    </aside>
  </div>

  <!-- Bottom dock -->
  <div class="dock" role="tablist" aria-label="Call to action options"></div>

  <!-- Floating popover layer -->
  <div class="pop-layer" aria-hidden="true">
    <div class="pop" id="cta-pop" role="region" aria-label="More options" aria-live="polite"></div>
  </div>

  <!-- Modal -->
  <div class="modal" id="cta-modal" aria-hidden="true" aria-labelledby="cta-modal-title" aria-modal="true" role="dialog">
    <div class="modal__card" role="document">
      <h4 id="cta-modal-title">Thank you</h4>
      <p>Your request has been received. We’ll review and reply with next steps.</p>
      <div class="modal__actions">
        <button class="btn-ghost" data-close-modal>Close</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const sec   = document.getElementById('cta');
      const dock  = sec.querySelector('.dock');
      const form  = sec.querySelector('#cta-form');
      const modal = sec.querySelector('#cta-modal');
      const hint  = sec.querySelector('#form-hint');
      const note  = sec.querySelector('#form-note');
      const layer = sec.querySelector('.pop-layer');
      const pop   = sec.querySelector('#cta-pop');

      const LINKS = { writings: '/writings', instruments: '/instruments' };
      const OPTIONS = [
        { key:'clarity', label:'Get Clarity', mode:'form' },
        { key:'explore', label:'Explore Further', mode:'popover',
          lines:['We piqued your interest. Wish to explore more? Start with our writings.'],
          actions:true },
        { key:'notyet',  label:'Not Yet', mode:'popover',
          lines:["You’re not ready. That’s clarity too."] },
      ];

      const buttons = [];
      let s7FormEverOpened = false; // remember if the form has ever been opened
      let pinnedKey = null;
      let hoverHideTimer = null;

      function cssVar(name, fallback){ const v = getComputedStyle(sec).getPropertyValue(name).trim(); return v || fallback; }
      function setFormVisible(on){
  const openVal = cssVar('--left-col-open', '1.55fr');
  sec.style.setProperty('--left-col', on ? openVal : '0fr');
  sec.classList.toggle('show-form', on);
  if (on) s7FormEverOpened = true; // <-- remember once opened
}

      function setPopOpen(on){ sec.classList.toggle('pop-open', !!on); }
      function setActive(key){
        buttons.forEach(b=>{
          const on = (b.dataset.key === key);
          b.classList.toggle('is-active', on);
          b.setAttribute('aria-selected', on ? 'true' : 'false');
        });
      }
      function buildButton(opt){
        const btn = document.createElement('div');
        btn.className = 'cta-btn'; btn.setAttribute('role','tab'); btn.setAttribute('tabindex','0'); btn.setAttribute('aria-selected','false');
        btn.dataset.key = opt.key; btn.textContent = opt.label; return btn;
      }

      function renderPop(opt){
        const actions = opt.actions ? `
          <div class="actions" aria-label="Explore actions">
            <button type="button" class="act-link" data-href="${LINKS.writings}" aria-label="Open Writings"><em>Writings</em></button>
            <button type="button" class="act-link" data-href="${LINKS.instruments}" aria-label="Open Instruments"><em>Instruments</em></button>
          </div>` : '';
        pop.innerHTML = `<span class="kicker"></span><ul>${(opt.lines||[]).map(x=>`<li>${x}</li>`).join('')}</ul>${actions}`;
      }

      function positionPop(btn){
        pop.style.display = 'block'; pop.dataset.show = 'true'; pop.removeAttribute('data-animate');
        const sr = sec.getBoundingClientRect(); const br = btn.getBoundingClientRect();
        const popW = pop.offsetWidth; const popH = pop.offsetHeight;
        const btnCenterX = br.left - sr.left + br.width/2;
        const spaceAbove = (br.top - sr.top); const margin = 12;
        let top, posAttr;
        if (spaceAbove >= popH + margin){ top = br.top - sr.top - popH - margin; posAttr='above'; }
        else { top = br.bottom - sr.top + margin; posAttr='below'; }
        let left = btnCenterX - popW/2; left = Math.max(8, Math.min(left, sr.width - popW - 8));
        pop.style.top = `${top}px`; pop.style.left = `${left}px`; pop.setAttribute('data-pos', posAttr);
        requestAnimationFrame(()=> pop.setAttribute('data-animate','in'));
      }

      function showPopFor(opt, btn, pin=false){
        if (!opt || opt.mode !== 'popover') return;
        clearTimeout(hoverHideTimer);
        renderPop(opt); positionPop(btn); layer.setAttribute('aria-hidden','false'); pop.dataset.key = opt.key;
        setPopOpen(true);
        if (pin){ pinnedKey = opt.key; } else if (!pinnedKey){ pinnedKey = null; }
      }
      function hidePop(force=false){
        if (pinnedKey && !force) return;
        pop.removeAttribute('data-animate');
        setTimeout(()=>{ pop.dataset.show='false'; pop.style.display='none'; layer.setAttribute('aria-hidden','true'); }, 260);
        setPopOpen(false);
      }

      OPTIONS.forEach(opt=>{
        const btn = buildButton(opt); dock.appendChild(btn); buttons.push(btn);
        if (opt.mode === 'form'){
          const pinOpen = ()=>{ btn.classList.add('is-pinned','is-open'); setActive('clarity'); setFormVisible(true); };
          btn.addEventListener('mouseenter', pinOpen);
          btn.addEventListener('focus', pinOpen);
          btn.addEventListener('click', ()=>{
            const pinned = btn.classList.contains('is-pinned');
            if (pinned){ btn.classList.remove('is-pinned','is-open','is-active'); setFormVisible(false); }
            else { pinOpen(); }
          });
        } else {
          btn.addEventListener('mouseenter', ()=>{ if (pinnedKey && pinnedKey !== opt.key) return; setActive(opt.key); showPopFor(opt, btn, false); });
          btn.addEventListener('mouseleave', ()=>{ if (pinnedKey) return; hoverHideTimer = setTimeout(()=> hidePop(false), 160); });
          pop.addEventListener('mouseenter', ()=>{ clearTimeout(hoverHideTimer); });
          pop.addEventListener('mouseleave', ()=>{ if (pinnedKey) return; hoverHideTimer = setTimeout(()=> hidePop(false), 120); });
          btn.addEventListener('click', ()=>{
            if (pinnedKey === opt.key){ pinnedKey = null; hidePop(true); btn.classList.remove('is-pinned'); return; }
            buttons.forEach(b=> b.classList.remove('is-pinned'));
            pinnedKey = opt.key; btn.classList.add('is-pinned'); setActive(opt.key); showPopFor(opt, btn, true);
          });
        }
        btn.addEventListener('keydown', (e)=>{ if (e.key==='Enter' || e.key===' '){ e.preventDefault(); btn.click(); } if (e.key==='Escape'){ pinnedKey=null; hidePop(true);} });
      });

      


      document.addEventListener('click', (e)=>{
        const inDock  = e.target.closest('.dock');
        const inPop   = e.target.closest('#cta-pop');
        const inForm  = e.target.closest('.form-card');
        if (inDock || inPop || inForm) return;
        pinnedKey = null; hidePop(true);
      });

      // Navigate from action buttons
      sec.addEventListener('click', (e)=>{
        const act = e.target.closest('.act-link'); if (!act) return; e.stopPropagation();
        const href = act.getAttribute('data-href'); if (!href) return;
        try { if (href[0] === '/' && window.history){ history.pushState({}, '', href); dispatchEvent(new Event('popstate')); } else { location.assign(href); } }
        catch(_) { location.assign(href); }
      });
      sec.addEventListener('keydown', (e)=>{
        const act = e.target.closest('.act-link'); if (!act) return;
        if (e.key==='Enter' || e.key===' '){ e.preventDefault(); act.click(); }
      });

      /* -------------------- Auto sequence: quote → form (once) -------------------- */
      let openedOnce = false;
      const io = new IntersectionObserver(entries=>{
        entries.forEach(entry=>{
          if (!entry.isIntersecting || openedOnce) return;

          const quote = sec.querySelector('.quote');
          const qDelay = parseInt(getComputedStyle(sec).getPropertyValue('--quote-delay')) || 300;
          const qDur   = parseInt(getComputedStyle(sec).getPropertyValue('--quote-dur'))   || 720;

          // 1) Start quote shrink
          setTimeout(()=>{
            if (quote) quote.classList.add('is-shrinking');

            // 2) After shrink settles, open the form + set active
            setTimeout(()=>{
              const clarity = [...dock.children].find(b=>b.dataset.key==='clarity');
              if (clarity){
                clarity.classList.add('is-pinned','is-open');
                setActive('clarity');
              }
              setFormVisible(true);
              s7FormEverOpened = true;
              openedOnce = true;

              // optional: focus first field
              const first = form.querySelector('#name');
              if (first) first.focus({preventScroll:true});
            }, qDur + 120); // small settle buffer

          }, qDelay);

          io.disconnect();
        });
      }, { threshold: 0.3 });
       // DON'T START YET — we'll start after S6 hands off:
      function startObservingQuote(){
        try { io.observe(sec); } catch(_) {}
      }


     
(function(){
  // Reverse (S7 -> S6)
  let revTransitioning = false;
  let touchStartY2 = 0;
  const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
  const EXIT_DURATION = prefersReduced ? 350 : 950;

  // Arm reverse only after S7 settles
  let reverseArmed = false;
  let armTO = null;

  // put this INSIDE the reverse IIFE, right after `let reverseArmed = false; let armTO = null;`
document.addEventListener('sectionchange', (e) => {
  const goingTo = e?.detail?.id;

  // Disarm by default
  reverseArmed = false;
  if (armTO) clearTimeout(armTO);

  if (goingTo === 's7') {
    // Arm after a short beat so inertial/bounce scroll from the handoff doesn't immediately send us back
    armTO = setTimeout(() => { reverseArmed = true; }, 300);
  }
  // if going back to s6, it stays false
});

  function isUpIntent(evt){
    if ('deltaY' in evt) return evt.deltaY < -12; // ignore tiny bounce
    if (evt.type === 'keydown'){
      const k = evt.key;
      return (k === 'PageUp' || k === 'Home' || k === 'ArrowUp' || (k === ' ' && evt.shiftKey));
    }
    return false;
  }
  function fromInteractiveTarget(e){
    const t = e.target;
    return !!(t && t.closest('input, textarea, select, button, .fselect, .chip, .act-link'));
  }
  function prevent(e){ e.preventDefault(); e.stopPropagation(); }
  function isActive(){ return document.getElementById('cta').classList.contains('is-active'); }

  
function startReturn(){
  
  document.body.style.overflow = '';

  // Local fallback: switch back to S6 yourself
  document.documentElement.classList.remove('phase-s7');
  sec.classList.remove('is-active','show-form','pop-open');
  sec.style.setProperty('--left-col','0fr');
  document.dispatchEvent(new CustomEvent('sectionchange', { detail: { id:'s6', from:'s7' }}));
}


  function onWheelUp(e){
    if (!isActive() || !reverseArmed) return;
    if (fromInteractiveTarget(e)) return;
    if (isUpIntent(e)){ prevent(e); startReturn(); }
  }
  function onKeyUp(e){
    if (!isActive() || !reverseArmed) return;
    if (fromInteractiveTarget(e)) return;
    if (isUpIntent(e)){ prevent(e); startReturn(); }
  }
  function onTouchStart2(e){ touchStartY2 = e.changedTouches[0].clientY; }
  function onTouchMove2(e){
    if (!isActive() || !reverseArmed) return;
    if (fromInteractiveTarget(e)) return;
    const dy = e.changedTouches[0].clientY - touchStartY2; // swipe down positive
    if (dy > 24){ prevent(e); startReturn(); }
  }

  // attach reverse listeners (capture so we can block native scroll)
  window.addEventListener('wheel', onWheelUp, { passive:false, capture:true });
  window.addEventListener('keydown', onKeyUp, { capture:true });
  window.addEventListener('touchstart', onTouchStart2, { passive:true, capture:true });
  window.addEventListener('touchmove', onTouchMove2, { passive:false, capture:true });
})();



      /* ------------------------------- Chips wiring ------------------------------ */
      (function(){
        const engagementHidden = form.querySelector('#engagement');
        form.querySelectorAll('.chip:not([data-radio])').forEach(ch=>{
          ch.addEventListener('click', ()=>{
            const on = ch.dataset.checked === 'true';
            ch.dataset.checked = on ? 'false' : 'true';
            const values = [...form.querySelectorAll('.chip:not([data-radio])[data-checked="true"]')].map(x=>x.dataset.value);
            engagementHidden.value = values.join(', ');
          });
        });
        const channelHidden = form.querySelector('#channel');
        form.querySelectorAll('.chip[data-radio="channel"]').forEach(ch=>{
          ch.addEventListener('click', ()=>{
            form.querySelectorAll('.chip[data-radio="channel"]').forEach(x=>x.dataset.checked='false');
            ch.dataset.checked = 'true'; channelHidden.value = ch.dataset.value;
          });
        });
      })();

      /* -------------------------- Fancy Selects (init) --------------------------- */
      function initFancySelect(root){
        const hiddenId   = root.dataset.for;
        const target     = document.getElementById(hiddenId);
        const btn        = root.querySelector('.fs-button');
        const valSpan    = root.querySelector('.fs-value');
        const pop        = root.querySelector('.fs-pop');
        const list       = root.querySelector('.fs-list');
        const wantsSearch= root.dataset.search === 'true';
        const searchEl   = wantsSearch ? root.querySelector('.fs-search') : null;
        let open = false;
        let activeIndex = -1;

        function filterItems(q){
          if(!wantsSearch) return;
          const qq = (q||'').trim().toLowerCase();
          [...list.children].forEach(li=>{
            const label = li.textContent.trim().toLowerCase();
            li.style.display = label.includes(qq) ? '' : 'none';
          });
          const visible = [...list.children].filter(li => li.style.display !== 'none');
          if(visible.length){
            activeIndex = [...list.children].indexOf(visible[0]);
          }
        }
        function fitToViewport(){
          const margin = 8;
          const b = btn.getBoundingClientRect();
          const available = Math.max(160, window.innerHeight - b.bottom - margin);
          pop.style.maxHeight = available + 'px';
          const searchH = searchEl ? (searchEl.offsetHeight + 12) : 0;
          const chrome = 16;
          list.style.maxHeight = Math.max(120, available - searchH - chrome) + 'px';
        }
        function setOpen(on){
          open = !!on;
          root.setAttribute('aria-expanded', open ? 'true' : 'false');
          btn.setAttribute('aria-expanded', open ? 'true' : 'false');
          pop.dataset.show = open ? 'true' : 'false';
          if(open){
            pop.style.display = 'block';
            root.setAttribute('data-pos','below');
            fitToViewport();
            requestAnimationFrame(()=>{
              pop.setAttribute('data-animate','in');
              if (searchEl){ searchEl.value=''; filterItems(''); searchEl.focus(); }
              else { (activeIndex>=0 ? list.children[activeIndex] : list.children[0]).focus(); }
            });
          } else {
            pop.removeAttribute('data-animate');
          }
        }
        window.addEventListener('resize', ()=>{ if(open) fitToViewport(); });
        window.addEventListener('scroll', ()=>{ if(open) fitToViewport(); }, { passive: true });

        function setValue(v, label){
          if (!target) return;
          target.value = v || '';
          if (v){
            valSpan.textContent = label || v;
            valSpan.classList.remove('fs-placeholder');
          } else {
            valSpan.textContent = 'Select one';
            valSpan.classList.add('fs-placeholder');
          }
          [...list.children].forEach((li,i)=>{
            const on = (li.dataset.value === v);
            li.setAttribute('aria-selected', on ? 'true' : 'false');
            if (on) activeIndex = i;
          });
        }
        function selectByIndex(i){
          const li = list.children[i];
          if (!li || li.style.display==='none') return;
          setValue(li.dataset.value, li.textContent.trim());
          setOpen(false); btn.focus();
        }
        btn.addEventListener('click', (e)=>{ e.stopPropagation(); setOpen(!open); });
        list.addEventListener('click', (e)=>{
          const li = e.target.closest('.fs-option'); if (!li) return;
          if (li.style.display==='none') return;
          setValue(li.dataset.value, li.textContent.trim()); setOpen(false); btn.focus();
        });
        btn.addEventListener('keydown', (e)=>{
          if (e.key==='ArrowDown' || e.key==='ArrowUp'){
            e.preventDefault(); setOpen(true);
            if (searchEl) searchEl.focus();
            else (activeIndex>=0? list.children[activeIndex] : list.children[0]).focus();
          }
          if (e.key==='Enter' || e.key===' '){
            e.preventDefault(); setOpen(!open);
            if (open){ if (searchEl) searchEl.focus(); else (activeIndex>=0? list.children[activeIndex] : list.children[0]).focus(); }
          }
          if (e.key==='Escape'){ setOpen(false); }
        });
        list.addEventListener('keydown', (e)=>{
          const all = [...list.children].filter(li => li.style.display !== 'none');
          const max = all.length - 1;
          const idxInAll = (el)=> all.indexOf(el);
          if (e.key==='ArrowDown'){ e.preventDefault(); activeIndex = Math.min(max, (idxInAll(list.children[activeIndex]) + 1) || 0); (all[activeIndex]||all[0]).focus(); }
          if (e.key==='ArrowUp'){   e.preventDefault(); activeIndex = Math.max(0,   (idxInAll(list.children[activeIndex]) - 1) || 0); (all[activeIndex]||all[0]).focus(); }
          if (e.key==='Home'){ e.preventDefault(); activeIndex = 0; (all[0]||list.children[0]).focus(); }
          if (e.key==='End'){  e.preventDefault(); activeIndex = max; (all[max]||list.children[list.children.length-1]).focus(); }
          if (e.key==='Enter' || e.key===' '){ e.preventDefault(); if(all[activeIndex]) setValue(all[activeIndex].dataset.value, all[activeIndex].textContent.trim()), setOpen(false), btn.focus(); }
          if (e.key==='Escape'){ e.preventDefault(); setOpen(false); btn.focus(); }
        });
        if (searchEl){
          searchEl.addEventListener('input', (e)=> filterItems(e.target.value));
          searchEl.addEventListener('click', (e)=> e.stopPropagation());
          searchEl.addEventListener('keydown', (e)=>{
            if (e.key==='ArrowDown'){ e.preventDefault();
              const firstVisible = [...list.children].find(li => li.style.display !== 'none');
              if (firstVisible) { activeIndex = [...list.children].indexOf(firstVisible); firstVisible.focus(); }
            }
            if (e.key==='Escape'){ e.preventDefault(); setOpen(false); btn.focus(); }
          });
        }
        [...list.children].forEach((li)=> li.setAttribute('tabindex','-1'));
        document.addEventListener('click', (e)=>{ if (!root.contains(e.target)) setOpen(false); });
        setValue(target.value || '');
      }

      /* ----------------------------- Countries data ---------------------------- */
      const COUNTRIES = `Afghanistan|Albania|Algeria|Andorra|Angola|Antigua and Barbuda|Argentina|Armenia|Australia|Austria|Azerbaijan|Bahamas|Bahrain|Bangladesh|Barbados|Belarus|Belgium|Belize|Benin|Bhutan|Bolivia|Bosnia and Herzegovina|Botswana|Brazil|Brunei|Bulgaria|Burkina Faso|Burundi|Cabo Verde|Cambodia|Cameroon|Canada|Central African Republic|Chad|Chile|China|Colombia|Comoros|Congo (Congo-Brazzaville)|Costa Rica|Côte d’Ivoire|Croatia|Cuba|Cyprus|Czechia|Democratic Republic of the Congo|Denmark|Djibouti|Dominica|Dominican Republic|Ecuador|Egypt|El Salvador|Equatorial Guinea|Eritrea|Estonia|Eswatini|Ethiopia|Fiji|Finland|France|Gabon|Gambia|Georgia|Germany|Ghana|Greece|Grenada|Guatemala|Guinea|Guinea-Bissau|Guyana|Haiti|Honduras|Hungary|Iceland|India|Indonesia|Iran|Iraq|Ireland|Israel|Italy|Jamaica|Japan|Jordan|Kazakhstan|Kenya|Kiribati|Kuwait|Kyrgyzstan|Laos|Latvia|Lebanon|Lesotho|Liberia|Libya|Liechtenstein|Lithuania|Luxembourg|Madagascar|Malawi|Malaysia|Maldives|Mali|Malta|Marshall Islands|Mauritania|Mauritius|Mexico|Micronesia|Moldova|Monaco|Mongolia|Montenegro|Morocco|Mozambique|Myanmar|Namibia|Nauru|Nepal|Netherlands|New Zealand|Nicaragua|Niger|Nigeria|North Korea|North Macedonia|Norway|Oman|Pakistan|Palau|Panama|Papua New Guinea|Paraguay|Peru|Philippines|Poland|Portugal|Qatar|Romania|Russia|Rwanda|Saint Kitts and Nevis|Saint Lucia|Saint Vincent and the Grenadines|Samoa|San Marino|Sao Tome and Principe|Saudi Arabia|Senegal|Serbia|Seychelles|Sierra Leone|Singapore|Slovakia|Slovenia|Solomon Islands|Somalia|South Africa|South Korea|South Sudan|Spain|Sri Lanka|Sudan|Suriname|Sweden|Switzerland|Syria|Taiwan|Tajikistan|Tanzania|Thailand|Timor-Leste|Togo|Tonga|Trinidad and Tobago|Tunisia|Turkey|Turkmenistan|Tuvalu|Uganda|Ukraine|United Arab Emirates|United Kingdom|United States|Uruguay|Uzbekistan|Vanuatu|Vatican City|Venezuela|Vietnam|Yemen|Zambia|Zimbabwe`.split('|');

      (function mountCountryList(){
        const root = sec.querySelector('.fselect[data-for="country_value"]');
        if(!root) return;
        const list = root.querySelector('.fs-list');
        if(!list) return;
        list.innerHTML = COUNTRIES.map(n =>
          `<li class="fs-option" role="option" data-value="${n}" tabindex="-1"><span class="fs-check"></span>${n}</li>`
        ).join('');
      })();

      // Mount all Fancy Selects
      sec.querySelectorAll('.fselect').forEach(initFancySelect);

      /* --------------------------- Form submit + UX --------------------------- */
      function showError(msg){
        hint.textContent = msg || '';
        hint.setAttribute('aria-hidden','false');
        note.hidden = true;
      }
      function clearError(){
        hint.textContent = '';
        hint.setAttribute('aria-hidden','true');
        note.hidden = false;
      }

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        clearError();

        const REQUIRED = ['name','email','message'];
        const data = Object.fromEntries(new FormData(form).entries());

        REQUIRED.forEach(id=>{
          const el = form.querySelector('#'+id);
          if (el) el.classList.remove('is-invalid');
        });

        const missing = REQUIRED.filter(k => !data[k] || (''+data[k]).trim()==='');
        if (missing.length){
          missing.forEach(k=>{
            const el = form.querySelector('#'+k);
            if (el) el.classList.add('is-invalid');
          });
          const first = form.querySelector('#'+missing[0]);
          if (first){
            first.focus({preventScroll:false});
            first.scrollIntoView({behavior:'smooth', block:'center'});
          }
          showError('Please complete all required fields.');
          return;
        }

        const email = (data.email||'').trim();
if (!missing.length && !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)) {
  const el = form.querySelector('#email');
  if (el) el.classList.add('is-invalid');
  showError('Please enter a valid email address.');
  el?.focus({preventScroll:false});
  el?.scrollIntoView({behavior:'smooth', block:'center'});
  return;
}


        // build payload (includes hidden fields)
        const fd = new FormData(form);

        // reCAPTCHA v3 token (silent)
try {
  if (window.grecaptcha && grecaptcha.execute) {
    await new Promise(res => grecaptcha.ready(res));
    const token = await grecaptcha.execute('6Lc4gs0rAAAAAI0aXXts_OCCquoEdduHM5l98EcH', { action: 'submit' });
    const hidden = document.getElementById('g-recaptcha-response');
    if (hidden) hidden.value = token;
    fd.set('g-recaptcha-response', token);
  }
} catch (_) {}


        // disable button during submit
        const btn = form.querySelector('.btn-primary');
        const btnLabel = btn ? btn.textContent : '';
        if (btn){ btn.disabled = true; btn.textContent = 'Sending…'; }

        try{
          const res = await fetch(form.getAttribute('action'), {
            method: 'POST',
            headers: { 'Accept': 'application/json' },
            body: fd
          });

          if (res.ok){
            form.reset();
            form.querySelectorAll('.chip').forEach(x=>x.dataset.checked='false');
            ['engagement','channel','role_value','when_value','country_value'].forEach(id=>{
              const el = form.querySelector('#'+id); if (el) el.value = '';
            });
            document.querySelectorAll('#cta .fselect .fs-value').forEach(v=>{
              v.textContent = 'Select one';
              v.classList.add('fs-placeholder');
            });
            clearError();
            openModal();
          } else {
            let msg = 'Something went wrong. Please try again or email us.';
            try {
              const j = await res.json();
              if (j && j.errors && j.errors.length){
                msg = j.errors.map(e => e.message).join(' ');
              }
            } catch(_){}
            showError(msg);
          }
        } catch(err){
          showError('Network error. Please try again or reach us via email.');
        } finally {
          if (btn){ btn.disabled = false; btn.textContent = btnLabel; }
        }
      });

      ['name','email','message'].forEach(id=>{
        const el = form.querySelector('#'+id);
        if (!el) return;
        el.addEventListener('input', ()=> el.classList.remove('is-invalid'));
      });

      function openModal(){ modal.setAttribute('aria-hidden','false'); sec.setAttribute('aria-busy','true'); modal.querySelector('[data-close-modal]').focus(); }
      function closeModal(){ modal.setAttribute('aria-hidden','true'); sec.removeAttribute('aria-busy'); }
      modal.addEventListener('click', (e)=>{ if (e.target === modal) closeModal(); });
      modal.querySelector('[data-close-modal]').addEventListener('click', closeModal);
      window.addEventListener('keydown', (e)=>{ if (e.key==='Escape') closeModal(); });


/* ===== S6 → S7 HANDOFF WIRING (add this) ===== */
document.addEventListener('sectionchange', (e)=>{
  const id = e?.detail?.id;

  if (id === 's7'){
    // show S7 and (by CSS) reveal the dock
    sec.classList.add('is-active');

    // reset transient UI
    pinnedKey = null;
    hidePop(true);
    buttons.forEach(b => b.classList.remove('is-pinned','is-open','is-active'));

    if (s7FormEverOpened){
      // REVISIT: make quote already small + open the form immediately
      const quote = sec.querySelector('.quote');

      // kill any delay and start at the final scale
      sec.style.setProperty('--quote-delay', '0');
      sec.style.setProperty('--q-start',
        getComputedStyle(sec).getPropertyValue('--q-end') || '1.1'
      );

      // snap to final pose for this paint
      sec.classList.add('instant');
      if (quote) quote.classList.add('is-shrinking');

      // pin & activate the Clarity button + open the form
      const clarity = [...dock.children].find(b => b.dataset.key === 'clarity');
      if (clarity){ clarity.classList.add('is-pinned','is-open','is-active'); }
      setFormVisible(true);

      // force a paint, then restore transitions
      void sec.offsetWidth;
      sec.classList.remove('instant');

        // 2) FORCE the browser to commit that pose (layout flush)
  void sec.offsetWidth; // or: sec.getBoundingClientRect();

  // 3) then animate back in
  requestAnimationFrame(()=>{
    // ADD THIS: stagger the return (70ms per box)
    const boxes = sec.querySelectorAll('.hbox');
    boxes.forEach((b,i)=> { b.style.transitionDelay = (i * 70) + 'ms'; });

    sec.classList.remove('is-exiting');

    // cleanup the ad-hoc delays after the animation finishes
    const retMs = parseInt(getComputedStyle(sec).getPropertyValue('--ret-dur')) || 2000;
    setTimeout(()=> boxes.forEach(b=> b.style.transitionDelay = ''), retMs + (boxes.length * 70) + 80);
  });


    } else {
      // FIRST TIME: let the quote shrink, then open the form
      setFormVisible(false);
      setTimeout(startObservingQuote, 120);
    }
  }

  if (id === 's6'){
    // leaving S7: hide form and popover state
    sec.classList.remove('is-active','show-form','pop-open');
    sec.style.setProperty('--left-col','0fr');
  }
});



// After S6's sweep completes, politely focus the first field (no scroll jump)
document.addEventListener('sectionSweepComplete', (e)=>{
  if (e?.detail?.id !== 's7') return;
  const first = sec.querySelector('#name');
  if (first){
    try { first.focus({ preventScroll: true }); } catch(_) { first.focus(); }
  }
});

      // Dev helper
      sec._cta = { buttons };
    })();

</script>


  <script src="https://www.google.com/recaptcha/api.js?render=6Lc4gs0rAAAAAI0aXXts_OCCquoEdduHM5l98EcH" async defer></script>


  <script>
/* === Parent → S6/S7 message bridge (open "Connect"/S7) + ACK === */
(function(){
  window.addEventListener('message', (evt)=>{
    const ok = (evt.origin === location.origin) || (evt.origin === 'null'); // allow file:// dev
    if (!ok) return;

    const data = evt.data || {};
    const wantsConnect = (data.type === 'elysian:focus-anchor' && data.target === 'connect')
                      || (data.type === 'elysian:jump' && data.to === 's7');
    if (!wantsConnect) return;

    // Show S7 immediately (your CTA)
    document.documentElement.classList.add('phase-s7');
    const cta = document.getElementById('cta');
    if (cta) cta.classList.add('is-active');

    // Tell internal listeners we switched
    document.dispatchEvent(new CustomEvent('sectionchange', { detail: { id:'s7', from:'s6' }}));

    // Lock body scroll while CTA is active
    document.body.style.overflow = 'hidden';

    // ACK back to parent so it can stop retrying
    try { parent.postMessage({ type:'elysian:s7-opened' }, (location.origin && location.origin !== 'null') ? location.origin : '*'); } catch(_) {}

    // Focus first field gently
    setTimeout(()=>{ try{ document.getElementById('name')?.focus({preventScroll:true}); }catch(_){ } }, 200);
  });
})();
</script>
<style>
  /* Tie the hero fade-back to the same --ret-dur you set in JS */
  #ways-we-work .hero__inner [data-exit="fade"]{
    transition: opacity var(--ret-dur, 600ms) var(--lux),
                filter  var(--ret-dur, 600ms) var(--lux) !important;
  }
</style>


</section>
