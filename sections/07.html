<section id="cta" class="s68" aria-label="Get Clarity CTA" tabindex="0">
  <!-- Video layer FIRST inside the section (full-bleed, consistent with #ways-we-work) -->
  <div class="vid-layer"
       data-src="video.webm"
       data-opacity="0.03"
       data-speed="0.35"
       data-blend="soft-light">
    <video class="vid" muted playsinline autoplay loop preload="metadata">
      <source src="video.webm" type="video/webm">
    </video>
  </div>

  <style>
    /* Local fonts (paths unchanged) */
    @font-face { font-family:'HelloParisLight'; src:url('./Fonts/helloparisserif-light.ttf') format('truetype'); font-display:swap; }
    @font-face { font-family:'Coterie';        src:url('./Fonts/coterie-regular.woff2')     format('woff2');   font-display:swap; }
    @font-face { font-family:'SimpleSerenity'; src:url('./Fonts/Simple-Serenity-Serif.ttf') format('truetype'); font-display:swap; }
    @font-face { font-family:'Eyesome';        src:url('./Fonts/Eyesome-Regular.otf')       format('opentype'); font-display:swap; }
    @font-face { font-family:'EyesomeI';       src:url('./Fonts/Eyesome-Italic.otf')        format('opentype'); font-display:swap; }
    @font-face { font-family:'Tanpearl';       src:url('./Fonts/Tan-Pearl.ttf')             format('truetype'); font-display:swap; }
    @font-face { font-family:'Centaur';        src:url('./Fonts/VNcentaur-Regular.ttf')     format('truetype'); font-display:swap; }
    @font-face { font-family:'Arcadian';       src:url('./Fonts/Arcadian.ttf')              format('opentype'); font-display:swap; }
    @font-face { font-family:'Arsenica';       src:url('./Fonts/ArsenicaTrial-Regular.otf') format('opentype'); font-display:swap; }
    @font-face { font-family:'Canela';         src:url('./Fonts/Canela-Bold.otf')           format('opentype'); font-display:swap; }
    @font-face { font-family:'Anecor';         src:url('./Fonts/anecor-gheroos.otf')        format('opentype'); font-display:swap; }
    @font-face { font-family:'cotoris';        src:url('./Fonts/cotoris.otf')               format('opentype'); font-weight:400; font-style:normal; font-display:swap; }
    @font-face { font-family:'cotorisi';       src:url('./Fonts/cotorisita.otf')            format('opentype'); font-weight:400; font-style:normal; font-display:swap; }

    /* =========================================================
       ULTRA-LUXE CTA — ONE SCREEN (w/ Fancy Selects)
       ========================================================= */
    #cta{
      /* Palette */
      --bg:#f8f5ef; --ink:#151311; --muted:#6f6d69; --panel:#ffffff; --hair:#e6e1d8;
      --danger:#b3261e;

      /* Typography families */
      --ff-display:'Eyesome', serif;
      --ff-ui: cotorisi, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;

      /* Typography sizes */
      --fs-title: clamp(20px, 2.5vw, 32px);
      --fs-label: 12.5px;
      --fs-input: 15px;
      --fs-textarea: 15px;
      --fs-chip: 12px;
      --fs-btn: clamp(16px, 1.8vw, 21px);
      --fs-quote: clamp(18px, 4vw, 28px);
      --fs-pop: clamp(15px, 1.6vw, 18px);
      --fs-kicker: clamp(12px,1.2vw,13px);

      /* Spacing & motion */
      --pad: clamp(18px, 4vw, 44px);
      --radius: 18px;
      --curve: cubic-bezier(.22,.61,.36,1);
      --t: 520ms; --t-fast: 220ms;

      /* Pop transitions */
      --t-pop: 380ms; --ease-pop: cubic-bezier(.22,.61,.36,1);

      /* Dock (bottom buttons) */
      --btn-gap: clamp(30px, 6vw, 70px);
      --dock-bottom: clamp(14px, 4.2vh, 34px);
      --dock-left: 50%;
      --dock-translate: -50%;
      --dock-justify: center;

      /* Fit one screen */
      --dock-gap: clamp(56px, 8.5vh, 72px);
      --dock-gap-open: clamp(52px, 8vh, 66px);
      --form-clear: clamp(12px, 1.6vh, 18px);

      /* Grid columns */
      --left-col: 0fr;
      --left-col-open: 1.55fr;
      --right-col: 1fr;

      /* POP LAYOUT (top squeeze) */
      --pop-space: clamp(160px, 26vh, 300px);
      --dim-amt: .38;

      /* Behavior */
      --auto-open-delay: 900;

      position:relative; display:block;
      height:100svh; min-height:100svh; max-height:100svh;
      overflow:hidden; background:var(--bg); color:var(--ink);
      -webkit-tap-highlight-color:transparent;
    }
    #cta.show-form{ --dock-gap: var(--dock-gap-open); }
    #cta *{ box-sizing:border-box; }

    /* Soft vignette */
    #cta::before{
      content:""; position:absolute; inset:-20%;
      background:
        radial-gradient(1200px 600px at 50% 110%, rgba(0,0,0,.08), transparent 60%),
        linear-gradient(to top, rgba(255,255,255,.18), transparent 30%);
      pointer-events:none; mix-blend-mode:multiply; opacity:.22;
    }

    /* === Video behind everything in CTA (consistent with #ways-we-work) === */
    #cta { position: relative; }
    #cta .vid-layer{
      --vid-opacity: .28;
      --vid-blend: soft-light;
      position:absolute; inset:0; z-index:0; pointer-events:none; overflow:hidden;
    }
    #cta .vid-layer .vid{
      position:absolute; inset:0; width:100%; height:100%;
      object-fit:cover; opacity:var(--vid-opacity); mix-blend-mode:var(--vid-blend);
      transform:translateZ(0);
    }
    #cta > *:not(.vid-layer){ position:relative; z-index:1; }

    /* Stage */
    #cta .panel{
      position:relative; height:100%; max-height:100%;
      padding: var(--pad);
      padding-bottom: calc(var(--dock-gap) + var(--form-clear));
      display:grid;
      grid-template-columns: var(--left-col) var(--right-col);
      gap: clamp(18px, 3.4vw, 40px);
      align-content:center; align-items:center; justify-content:center;
      max-width:1360px; margin:0 auto; width:100%;
      transition:
        grid-template-columns var(--t) var(--curve),
        padding-bottom var(--t) var(--curve),
        transform var(--t) var(--curve);
      overflow:hidden;
    }

    /* Squeeze when popover shows */
    #cta.show-form.pop-open .panel{
      padding-bottom: calc(var(--dock-gap) + var(--form-clear) + var(--pop-space));
      transform: translateY(calc(var(--pop-space) * -0.10));
    }

    /* Form card — soft, elegant shadow */
    #cta .form-card{
      background: var(--panel);
      border:1px solid color-mix(in oklab, var(--hair) 85%, #000 15%);
      border-radius: calc(var(--radius) + 2px);
      box-shadow:
        0 0 0 1px rgba(0,0,0,.03),
        0 10px 22px rgba(0,0,0,.08),
        0 2px 6px rgba(0,0,0,.04);
      padding: clamp(14px, 2.2vw, 24px) clamp(14px, 2.2vw, 24px) clamp(10px, 1.6vw, 14px);
      opacity:0; transform: translateY(6px) scale(.992);
      pointer-events:none;
      transition:
        opacity var(--t) var(--curve),
        transform var(--t) var(--curve),
        max-height var(--t) var(--curve);
      height: calc(100svh - var(--pad)*2 - calc(var(--dock-gap) + var(--form-clear)));
      max-height: calc(100svh - var(--pad)*2 - calc(var(--dock-gap) + var(--form-clear)));
      display:flex; flex-direction:column; justify-content:flex-start;
      overflow:hidden;
    }
    #cta.show-form .form-card{ opacity:1; transform:none; pointer-events:auto; }
    #cta.show-form.pop-open .form-card{
      max-height: calc(100svh - var(--pad)*2 - calc(var(--dock-gap) + var(--form-clear)) - var(--pop-space));
    }

    #cta .form-card h3{
      margin: 0 0 10px; padding: 0 0 10px; border-bottom: 1px solid var(--hair);
      font-family: 'eyesomei'; font-size: 25px; font-weight: 400; letter-spacing:-.01em; flex:0 0 auto;
    }

    /* Form */
    #cta .form{ display:grid; gap:10px; flex:1 0 auto; }
    #cta .row{ display:grid; grid-template-columns: 0.7fr 1.2fr; gap:10px; }

    /* 3-column row for channel + timeframe + country */
    #cta .row.row-3{ grid-template-columns: 1fr 1fr 1fr; }
    @media (max-width: 900px){
      #cta .row{ grid-template-columns:1fr; }
      #cta .row.row-3{ grid-template-columns:1fr; }
      #cta .panel{ grid-template-columns: var(--left-col) 1fr; }
      #cta .form-card{ height: calc(100svh - var(--pad)*2 - calc(var(--dock-gap) + var(--form-clear))); }
      #cta .quote{ order: 2; }
    }

    #cta .form label{ display:block; margin-bottom:4px; color:var(--muted); font:600 var(--fs-label)/1.2 var(--ff-ui); letter-spacing:.02em; }
    /* Red asterisk on required labels */
    #cta label.req::after{ content:" *"; color:var(--danger); font-weight:700; }

    #cta .form input[type="text"],
    #cta .form input[type="email"],
    #cta .form textarea{
      width:100%; border:1px solid var(--hair); border-radius:12px; background:#fff; color:#000;
      padding:10px 12px; font:500 var(--fs-input)/1.45 var(--ff-ui); outline:none;
      transition: border-color var(--t-fast) var(--curve), box-shadow var(--t-fast) var(--curve), transform var(--t-fast) var(--curve);
    }
    #cta .form textarea{ min-height:92px; max-height:22vh; resize:vertical; font-size: var(--fs-textarea); }
    #cta .form input:focus, #cta .form textarea:focus{
      border-color:#b4ab9d; box-shadow: 0 12px 30px rgba(0,0,0,.10); transform: translateY(-1px);
    }

    /* Invalid highlight */
    #cta .is-invalid{
      border-color: var(--danger) !important;
      box-shadow: 0 10px 24px rgba(179,38,30,.10) !important;
    }

    /* Chips */
    #cta .choices{ display:flex; flex-wrap:wrap; gap:10px; }
    #cta .chip{
      display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border:1px solid var(--hair);
      border-radius:999px; background: color-mix(in oklab, #fff 92%, #000 8%);
      font:600 var(--fs-chip)/1 var(--ff-ui); cursor:pointer; user-select:none;
      transition: all var(--t-fast) var(--curve); min-height: 38px;
    }
    #cta .chip:hover{ transform: translateY(-1px); box-shadow: 0 10px 28px rgba(0,0,0,.08); }
    #cta .chip[data-checked="true"]{ background:#111; color:#fff; border-color:#111; }

    /* Submit area */
    #cta .submit{ display:flex; align-items:flex-start; gap:10px; }
    #cta .btn-primary{
      height:44px; padding:0 16px; border-radius:12px; border:1px solid #fff; background:#f8f5ef; color:#1a1a1a;
      font:700 14px/1 var(--ff-ui); cursor:pointer; box-shadow: 0 10px 22px rgba(0,0,0,.12);
      transition: transform var(--t-fast) var(--curve), box-shadow var(--t-fast) var(--curve);
    }
    #cta .btn-primary:hover{ transform: translateY(-1px); }

    #cta #form-hint.hint{
      color: var(--danger);
      font:600 12.5px/1.25 var(--ff-ui);
      opacity:0; transition: opacity var(--t-fast) var(--curve);
    }
    #cta #form-hint.hint[aria-hidden="false"]{ opacity:1; }

    #cta #form-note.note{
      margin-left:auto; color: var(--muted);
      font:500 12.5px/1.25 var(--ff-ui);
      max-width: 56ch; text-align:right; margin-top: 4px;
    }

    /* Quote */
    #cta .quote{
      position:relative; display:flex; align-items:center; justify-content:center;
      padding: clamp(6px, 1.6vw, 14px);
      color:#1d1a17; text-align:center; min-height: 120px;
      max-width: 48ch; margin-inline:auto;
      font-family: 'cotorisi';
      overflow:hidden;
      transition: opacity var(--t-fast) var(--curve), filter var(--t-fast) var(--curve);
    }
    #cta .quote::before{
      content:"“"; position:absolute; inset:auto auto 100% 50%; transform: translate(-50%, 18%);
      font-family: var(--ff-display); font-size: clamp(42px, 5.2vw, 72px); line-height:1; color:#000; opacity:.10; filter: blur(.3px);
    }
    #cta .quote::after{
      content:""; position:absolute; left:50%; bottom:-8px; width:120px; height:1px; transform: translateX(-50%);
      background: linear-gradient(90deg, transparent, rgba(0,0,0,.55), transparent); opacity:.65;
    }

    /* Selective dim */
    #cta.pop-open .panel > :not(.quote){
      opacity: var(--dim-amt);
      filter: saturate(.9) blur(.1px);
      transition: opacity var(--t-fast) var(--curve), filter var(--t-fast) var(--curve);
    }
    #cta.pop-open .dock .cta-btn{ opacity: var(--dim-amt); filter: saturate(.9) blur(.1px); }
    #cta.pop-open .dock .cta-btn.is-active,
    #cta.pop-open .dock .cta-btn:hover,
    #cta.pop-open .dock .cta-btn:focus-visible{ opacity:1 !important; filter:none !important; }

    /* Dock */
    #cta .dock{
      position:absolute; left: var(--dock-left); bottom: var(--dock-bottom);
      transform: translateX(var(--dock-translate));
      display:flex; justify-content: var(--dock-justify); gap: var(--btn-gap);
      padding:0; background:none; border:0; z-index:300;
      flex-wrap: nowrap; white-space: nowrap;
      overflow-x: auto; overflow-y: visible;
      -webkit-overflow-scrolling: touch; scrollbar-width: none;
    }
    #cta .dock::-webkit-scrollbar{ display:none; }
    #cta .cta-btn{
      position:relative; display:inline-flex; align-items:center; justify-content:center;
      background:transparent; border:none; padding:6px 2px;
      color:#14110e; cursor:pointer; letter-spacing:.20em; text-transform:uppercase;
      font-family: 'EyesomeI';
      font-weight: 600;
      transition: transform var(--t-fast) var(--curve), opacity var(--t-fast) var(--curve);
      will-change: transform; z-index: 310; outline: none;
    }
    #cta .cta-btn:hover, #cta .cta-btn:focus-visible{ transform: translateY(-0.5px); }
    #cta .cta-btn.is-active{ opacity:.98; }

    /* Floating Popover */
    #cta .pop-layer{ position:absolute; inset:0; pointer-events:none; z-index:1100; }
    #cta .pop{
      position:absolute; display:none; pointer-events:auto;
      max-width:min(78vw, 650px);
      background:#fff; color:#151311;
      border:1px solid color-mix(in oklab, var(--hair) 85%, #000 15%);
      border-radius:14px; box-shadow: 0 24px 80px rgba(0,0,0,.18);
      padding:14px 16px;
      font:500 var(--fs-pop)/1.6 var(--ff-ui);
      opacity:0; transform: translateY(10px) scale(.985); filter: blur(2px);
      transition: opacity var(--t-pop) var(--ease-pop), transform var(--t-pop) var(--ease-pop), filter var(--t-pop) var(--ease-pop);
      will-change: opacity, transform, filter;
    }
    #cta .pop[data-show="true"]{ display:block; }
    #cta .pop[data-animate="in"]{ opacity:1; transform:none; filter:none; }
    #cta .pop .kicker{ display:block; letter-spacing:.18em; text-transform:uppercase; font:700 var(--fs-kicker)/1 var(--ff-ui); opacity:.8; margin-bottom:6px; }
    #cta .pop ul{ list-style:none; margin:0 0 10px 0; padding:0; }
    #cta .pop li{ margin:.36rem 0; }
    #cta .pop li::before{ content:'✧'; opacity:.65; margin-right:.25em; }
    #cta .pop .actions{ display:flex; gap:14px; justify-content:center; margin-top:8px; }
    #cta .pop .act-link{
      display:inline-flex; align-items:center; justify-content:center;
      min-width:132px; height:36px; padding:0 18px; border-radius:999px;
      border:1px solid color-mix(in oklab, var(--hair) 80%, #000 20%);
      background:#fff; color:#1a1a1a; cursor:pointer; user-select:none;
      font:700 12px/1 var(--ff-ui); letter-spacing:.12em; text-transform:uppercase;
      font-style: italic; text-decoration: none; text-underline-offset: 3px;
      text-decoration-thickness: 1px; text-decoration-color: color-mix(in oklab, currentColor 60%, transparent);
      transition: transform var(--t-fast) var(--curve), box-shadow var(--t-fast) var(--curve), text-decoration-color var(--t-fast) var(--curve);
    }
    #cta .pop .act-link:hover, #cta .pop .act-link:focus-visible{ transform: translateY(-1px); box-shadow: 0 12px 28px rgba(0,0,0,.12); text-decoration-color: currentColor; }
    #cta .pop::after{
      content:""; position:absolute; width:12px; height:12px; background:#fff;
      border-left:1px solid color-mix(in oklab, var(--hair) 85%, #000 15%);
      border-top:1px solid color-mix(in oklab, var(--hair) 85%, #000 15%);
      transform: rotate(45deg); left: calc(50% - 6px);
    }
    #cta .pop[data-pos="above"]::after{ bottom:-7px; box-shadow: 2px 2px 8px rgba(0,0,0,.08); }
    #cta .pop[data-pos="below"]::after{ top:-7px; transform: rotate(225deg); box-shadow: -2px -2px 8px rgba(0,0,0,.08); }

    /* Modal */
    #cta .modal{ position:fixed; inset:0; display:grid; place-items:center; background: rgba(10,10,10,.46);
      opacity:0; pointer-events:none; transition: opacity var(--t) var(--curve); z-index:2000; }
    #cta .modal[aria-hidden="false"]{ opacity:1; pointer-events:auto; }
    #cta .modal__card{ width:min(560px, 92vw); background:#fff; color:#111; border-radius:20px; border:1px solid var(--hair); padding:22px; box-shadow: 0 44px 120px rgba(0,0,0,.28); }
    #cta .modal__card h4{ margin:0 0 8px; font-family: var(--ff-display); font-size: clamp(20px, 2.2vw, 26px); }
    #cta .modal__card p{ margin:0 0 12px; font:500 15px/1.6 var(--ff-ui); color:#2b2925; }
    #cta .modal__actions{ display:flex; justify-content:flex-end; gap:10px; }
    #cta .btn-ghost{ height:42px; padding:0 14px; border-radius:10px; border:1px solid var(--hair); background:#fff; cursor:pointer; font:700 14px/1 var(--ff-ui); }

    @media (max-height: 760px){
      #cta .form textarea{ min-height:84px; }
      #cta .btn-primary{ height:42px; }
      #cta .quote{ font-size: clamp(16px, 4vw, 24px); }
    }
    @media (prefers-reduced-motion: reduce){
      #cta *{ transition:none !important; }
    }

    /* =============== FANCY SELECTS (ultra high-end) =============== */
    .fselect{ position:relative; }
    .fselect .fs-button{
      width:100%; display:flex; align-items:center; justify-content:space-between; gap:12px;
      background: linear-gradient(180deg, #fff, #fff);
      border:1px solid var(--hair); border-radius:12px; padding:10px 12px;
      font:500 var(--fs-input)/1.45 var(--ff-ui); color:#111;
      cursor:pointer; user-select:none;
      box-shadow: 0 1px 0 rgba(255,255,255,.4) inset, 0 6px 16px rgba(0,0,0,.06);
      transition: border-color var(--t-fast) var(--curve), box-shadow var(--t-fast) var(--curve), transform var(--t-fast) var(--curve), background var(--t-fast) var(--curve);
    }
    .fselect .fs-button:hover{ transform: translateY(-1px); box-shadow: 0 12px 28px rgba(0,0,0,.08); }
    .fselect[aria-expanded="true"] .fs-button{ border-color:#b4ab9d; }
    .fselect .fs-placeholder{ color: #8d887f; }
    .fselect .fs-value{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .fselect .fs-chevron{
      flex:0 0 auto; width:18px; height:18px; position:relative;
    }
    .fselect .fs-chevron::before, .fselect .fs-chevron::after{
      content:""; position:absolute; inset:0; margin:auto; width:10px; height:10px;
      border-right:2px solid #3a3733; border-bottom:2px solid #3a3733; transform: rotate(45deg) translateY(-1px); opacity:.66;
      transition: transform var(--t-fast) var(--curve), opacity var(--t-fast) var(--curve);
    }
    .fselect[aria-expanded="true"] .fs-chevron::before{ transform: rotate(-135deg) translateY(1px); opacity:.9; }

    .fselect .fs-pop{
      position:absolute; left:0; right:0; top: calc(100% + 8px); z-index: 500;
      background: rgba(255,255,255,.85);
      -webkit-backdrop-filter: saturate(1.1) blur(6px); backdrop-filter: saturate(1.1) blur(6px);
      border:1px solid color-mix(in oklab, var(--hair) 85%, #000 15%);
      border-radius:14px; box-shadow: 0 26px 80px rgba(0,0,0,.18), 0 1px 0 rgba(255,255,255,.35) inset;
      overflow:hidden; display:none;
      opacity:0; transform: translateY(6px) scale(.985); filter: blur(1.5px);
      transition: opacity var(--t-pop) var(--ease-pop), transform var(--t-pop) var(--ease-pop), filter var(--t-pop) var(--ease-pop);
    }
    .fselect .fs-pop[data-show="true"]{ display:block; }
    .fselect .fs-pop[data-animate="in"]{ opacity:1; transform:none; filter:none; }

    .fselect .fs-list{ list-style:none; margin:0; padding:6px; max-height:220px; overflow:auto; }
    .fselect .fs-option{
      display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:10px; cursor:pointer;
      font:500 var(--fs-input)/1.35 var(--ff-ui); color:#23201a; letter-spacing:.01em;
      transition: background var(--t-fast) var(--curve), transform var(--t-fast) var(--curve);
    }
    .fselect .fs-option[aria-selected="true"]{ background: color-mix(in oklab, #111 8%, #fff 92%); }
    .fselect .fs-option:hover{ background: color-mix(in oklab, #111 6%, #fff 94%); transform: translateY(-0.5px); }
    .fselect .fs-check{
      width:14px; height:14px; border-radius:3px; border:1px solid color-mix(in oklab, var(--hair) 80%, #000 20%);
      display:inline-block; position:relative; flex:0 0 auto;
      background: #fff;
    }
    .fselect .fs-option[aria-selected="true"] .fs-check{
      background:#111; border-color:#111;
    }
    .fselect .fs-option[aria-selected="true"] .fs-check::after{
      content:""; position:absolute; left:3px; top:0px; width:6px; height:10px; border-right:2px solid #fff; border-bottom:2px solid #fff; transform: rotate(45deg);
    }

    /* native selects hidden (progressive enhancement) */
    .native-hidden{ display:none !important; }

    /* allow popup to escape card while open (modern browsers) */
    #cta .form-card:has(.fselect[aria-expanded="true"]){ overflow: visible; }

    /* Small spacing on choices block */
    #cta .form label + .choices{ margin-top: 8px; }

    /* --- original "flip above" support (kept) --- */
    .fselect[data-pos="above"] .fs-pop{ top:auto; bottom: calc(100% + 8px); }

    /* ================= Extra for searchable country ================= */
    .fselect .fs-search{
      width: calc(100% - 12px);
      margin: 8px 6px 4px;
      padding: 8px 10px;
      border:1px solid var(--hair);
      border-radius:10px;
      font:500 var(--fs-input)/1.35 var(--ff-ui);
      outline:none;
      transition: border-color var(--t-fast) var(--curve), box-shadow var(--t-fast) var(--curve);
      background:#fff;
    }
    .fselect .fs-search:focus{
      border-color:#b4ab9d; box-shadow:0 10px 24px rgba(0,0,0,.08);
    }
    /* a touch more room for long country lists */
    .fselect .fs-pop .fs-list{ max-height: 280px; }

    /* ========= Force all Fancy Select popups to open BELOW ========= */
    .fselect .fs-pop{ top: calc(100% + 8px) !important; bottom: auto !important; }
    .fselect[data-pos="above"] .fs-pop{ top: calc(100% + 8px) !important; bottom: auto !important; }
  </style>

  <div class="panel" role="group" aria-label="CTA Panel">
    <div class="form-card">
      <h3>Get Clarity</h3>
      <form class="form" id="cta-form" novalidate
      action="https://formspree.io/f/xwpnddnl"
      method="POST">
        <input type="hidden" name="_subject" value="New inquiry — Elysian Advisory">
        <input type="hidden" name="_origin"  value="CTA form on elysianclarity.com">
        <div class="row">
          <div>
            <label for="name" class="req">Your name</label>
            <input id="name" name="name" type="text" autocomplete="name" required />
          </div>
          <div>
            <label for="email" class="req">Email</label>
            <input id="email" name="email" type="email" autocomplete="email" required />
          </div>
        </div>
<input type="hidden" name="g-recaptcha-response" id="g-recaptcha-response">

        <div class="row">
          <div>
            <label for="role">Role</label>
            <!-- native for fallback (hidden/enhanced) -->
            <select id="role" class="native-hidden" disabled>
              <option value="" disabled selected>Select one</option>
              <option>Founder</option>
              <option>CEO</option>
              <option>Operator</option>
              <option>Solo Strategist</option>
              <option>Other</option>
            </select>
            <!-- hidden field that actually submits -->
            <input type="hidden" name="role" id="role_value" />
            <!-- Fancy Select mount -->
            <div class="fselect" data-for="role_value" aria-haspopup="listbox" aria-expanded="false">
              <button type="button" class="fs-button" aria-label="Choose role" aria-controls="fs-role-list" aria-expanded="false">
                <span class="fs-value fs-placeholder">Select one</span>
                <span class="fs-chevron" aria-hidden="true"></span>
              </button>
              <div class="fs-pop" id="fs-role-pop">
                <ul class="fs-list" id="fs-role-list" role="listbox" aria-label="Role options">
                  <li class="fs-option" role="option" data-value="Founder"         tabindex="0"><span class="fs-check"></span>Founder</li>
                  <li class="fs-option" role="option" data-value="CEO"              tabindex="0"><span class="fs-check"></span>CEO</li>
                  <li class="fs-option" role="option" data-value="Operator"         tabindex="0"><span class="fs-check"></span>Operator</li>
                  <li class="fs-option" role="option" data-value="Solo Strategist"  tabindex="0"><span class="fs-check"></span>Solo Strategist</li>
                  <li class="fs-option" role="option" data-value="Other"            tabindex="0"><span class="fs-check"></span>Other</li>
                </ul>
              </div>
            </div>
          </div>

          <div>
            <label>Engagement</label>
            <div class="choices" role="group" aria-label="Engagement type">
              <button type="button" class="chip" data-value="Audit">Clarity Session</button>
              <button type="button" class="chip" data-value="Sprint">Project-Wise Engagement</button>
              <button type="button" class="chip" data-value="Retainer">Ongoing Partnership</button>
            </div>
            <input type="hidden" name="engagement" id="engagement" />
          </div>
        </div>

        <!-- THREE-COLUMN ROW: channel, timeframe, country -->
        <div class="row row-3">
          <div>
            <label>Preferred channel</label>
            <div class="choices" role="radiogroup" aria-label="Preferred channel">
              <button type="button" class="chip" data-radio="channel" data-value="Phone">Phone</button>
              <button type="button" class="chip" data-radio="channel" data-value="Video">Video</button>
              <button type="button" class="chip" data-radio="channel" data-value="Email">Email</button>
            </div>
            <input type="hidden" name="channel" id="channel" />
          </div>
          <p style="position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden;">
  <label>Leave this field empty
    <input type="text" name="_gotcha" tabindex="-1" autocomplete="off">
  </label>
</p>          <div>
            <label for="when">Ideal timeframe</label>
            <!-- native (hidden/enhanced) -->
            <select id="when" class="native-hidden" disabled>
              <option>ASAP</option>
              <option>This week</option>
              <option>Within 2 weeks</option>
              <option>This month</option>
            </select>
            <input type="hidden" name="when" id="when_value" />
            <!-- Fancy Select mount -->
            <div class="fselect" data-for="when_value" aria-haspopup="listbox" aria-expanded="false">
              <button type="button" class="fs-button" aria-label="Choose timeframe" aria-controls="fs-when-list" aria-expanded="false">
                <span class="fs-value fs-placeholder">Choose timeframe</span>
                <span class="fs-chevron" aria-hidden="true"></span>
              </button>
              <div class="fs-pop" id="fs-when-pop">
                <ul class="fs-list" id="fs-when-list" role="listbox" aria-label="Ideal timeframe">
                  <li class="fs-option" role="option" data-value="ASAP"             tabindex="0"><span class="fs-check"></span>ASAP</li>
                  <li class="fs-option" role="option" data-value="This week"        tabindex="0"><span class="fs-check"></span>This week</li>
                  <li class="fs-option" role="option" data-value="Within 2 weeks"   tabindex="0"><span class="fs-check"></span>Within 2 weeks</li>
                  <li class="fs-option" role="option" data-value="This month"       tabindex="0"><span class="fs-check"></span>This month</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Reaching from (country) -->
          <div>
            <label for="country_value">Reaching from</label>
            <input type="hidden" name="country" id="country_value" />
            <div class="fselect" data-for="country_value" data-search="true" aria-haspopup="listbox" aria-expanded="false">
              <button type="button" class="fs-button" aria-label="Choose country" aria-controls="fs-country-list" aria-expanded="false">
                <span class="fs-value fs-placeholder">Select country</span>
                <span class="fs-chevron" aria-hidden="true"></span>
              </button>
              <div class="fs-pop" id="fs-country-pop">
                <!-- inline search field (only for data-search="true") -->
                <input type="text" class="fs-search" placeholder="Type to filter…" aria-label="Search countries" />
                <ul class="fs-list" id="fs-country-list" role="listbox" aria-label="Country options"></ul>
              </div>
            </div>
          </div>
        </div>

        <div>
          <label for="message" class="req">Context / Aim</label>
          <textarea id="message" name="message" placeholder="Tell us where clarity would move the needle…" required></textarea>
        </div>

        <div class="submit">
          <button class="btn-primary" type="submit">Seek Clarity</button>
          <span id="form-hint" class="hint" aria-live="polite" aria-hidden="true"></span>
          <span id="form-note" class="note">Clarity demands honesty — <br> your details are received in confidence, used solely to connect.</span>
        </div>
      </form>
    </div>

    <aside class="quote" role="note">
      “The truth is always there. <br>You just need someone
      brutal enough to show it,<br>and calm enough to map what’s next.
      <br>That’s Clarity. That’s Elysian.”
    </aside>
  </div>

  <!-- Bottom dock -->
  <div class="dock" role="tablist" aria-label="Call to action options"></div>

  <!-- Floating popover layer (outside the dock for no clipping) -->
  <div class="pop-layer" aria-hidden="true">
    <div class="pop" id="cta-pop" role="dialog" aria-modal="false" aria-live="polite"></div>
  </div>

  <div class="modal" id="cta-modal" aria-hidden="true" aria-labelledby="cta-modal-title" aria-modal="true" role="dialog">
    <div class="modal__card" role="document">
      <h4 id="cta-modal-title">Thank you</h4>
      <p>Your request has been received. We’ll review and reply with next steps.</p>
      <div class="modal__actions">
        <button class="btn-ghost" data-close-modal>Close</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const sec   = document.getElementById('cta');
      const dock  = sec.querySelector('.dock');
      const form  = sec.querySelector('#cta-form');
      const modal = sec.querySelector('#cta-modal');
      const hint  = sec.querySelector('#form-hint');
      const note  = sec.querySelector('#form-note');
      const layer = sec.querySelector('.pop-layer');
      const pop   = sec.querySelector('#cta-pop');

      const LINKS = { writings: '/writings', instruments: '/instruments' };

      const OPTIONS = [
        { key:'clarity', label:'Get Clarity', mode:'form' },
        { key:'explore', label:'Explore Further', mode:'popover',
          lines:['We piqued your interest. Wish to explore more? Start with our writings.'],
          actions:true },
        { key:'notyet',  label:'Not Yet', mode:'popover',
          lines:["You’re not ready. That’s clarity too."] },
      ];

      const buttons = [];
      let pinnedKey = null;  // which key is currently pinned (if any)
      let hoverHideTimer = null;

      function cssVar(name, fallback){ const v = getComputedStyle(sec).getPropertyValue(name).trim(); return v || fallback; }
      function setFormVisible(on){
        const openVal = cssVar('--left-col-open', '1.55fr');
        sec.style.setProperty('--left-col', on ? openVal : '0fr');
        sec.classList.toggle('show-form', on);
      }
      function setPopOpen(on){ sec.classList.toggle('pop-open', !!on); }
      function setActive(key){
        buttons.forEach(b=>{
          const on = (b.dataset.key === key);
          b.classList.toggle('is-active', on);
          b.setAttribute('aria-selected', on ? 'true' : 'false');
        });
      }
      function buildButton(opt){
        const btn = document.createElement('div');
        btn.className = 'cta-btn'; btn.setAttribute('role','tab'); btn.setAttribute('tabindex','0'); btn.setAttribute('aria-selected','false');
        btn.dataset.key = opt.key; btn.textContent = opt.label; return btn;
      }

      function renderPop(opt){
        const actions = opt.actions ? `
          <div class="actions" aria-label="Explore actions">
            <button type="button" class="act-link" data-href="${LINKS.writings}" aria-label="Open Writings"><em>Writings</em></button>
            <button type="button" class="act-link" data-href="${LINKS.instruments}" aria-label="Open Instruments"><em>Instruments</em></button>
          </div>` : '';
        pop.innerHTML = `<span class="kicker"></span><ul>${(opt.lines||[]).map(x=>`<li>${x}</li>`).join('')}</ul>${actions}`;
      }

      function positionPop(btn){
        pop.style.display = 'block'; pop.dataset.show = 'true'; pop.removeAttribute('data-animate');
        const sr = sec.getBoundingClientRect(); const br = btn.getBoundingClientRect();
        const popW = pop.offsetWidth; const popH = pop.offsetHeight;
        const btnCenterX = br.left - sr.left + br.width/2;
        const spaceAbove = (br.top - sr.top); const spaceBelow = (sr.bottom - br.bottom);
        const margin = 12;
        let top, posAttr;
        if (spaceAbove >= popH + margin){ top = br.top - sr.top - popH - margin; posAttr='above'; }
        else { top = br.bottom - sr.top + margin; posAttr='below'; }
        let left = btnCenterX - popW/2; left = Math.max(8, Math.min(left, sr.width - popW - 8));
        pop.style.top = `${top}px`; pop.style.left = `${left}px`; pop.setAttribute('data-pos', posAttr);
        requestAnimationFrame(()=> pop.setAttribute('data-animate','in'));
      }

      function showPopFor(opt, btn, pin=false){
        if (!opt || opt.mode !== 'popover') return;
        clearTimeout(hoverHideTimer);
        renderPop(opt); positionPop(btn); layer.setAttribute('aria-hidden','false'); pop.dataset.key = opt.key;
        setPopOpen(true);
        if (pin){ pinnedKey = opt.key; } else if (!pinnedKey){ pinnedKey = null; }
      }
      function hidePop(force=false){
        if (pinnedKey && !force) return;
        pop.removeAttribute('data-animate');
        setTimeout(()=>{ pop.dataset.show='false'; pop.style.display='none'; layer.setAttribute('aria-hidden','true'); }, 260);
        setPopOpen(false);
      }

      OPTIONS.forEach(opt=>{
        const btn = buildButton(opt); dock.appendChild(btn); buttons.push(btn);
        if (opt.mode === 'form'){
          const pinOpen = ()=>{ btn.classList.add('is-pinned','is-open'); setActive('clarity'); setFormVisible(true); };
          btn.addEventListener('mouseenter', pinOpen);
          btn.addEventListener('focus', pinOpen);
          btn.addEventListener('click', ()=>{
            const pinned = btn.classList.contains('is-pinned');
            if (pinned){ btn.classList.remove('is-pinned','is-open','is-active'); setFormVisible(false); }
            else { pinOpen(); }
          });
        } else {
          btn.addEventListener('mouseenter', ()=>{ if (pinnedKey && pinnedKey !== opt.key) return; setActive(opt.key); showPopFor(opt, btn, false); });
          btn.addEventListener('mouseleave', ()=>{ if (pinnedKey) return; hoverHideTimer = setTimeout(()=> hidePop(false), 160); });
          pop.addEventListener('mouseenter', ()=>{ clearTimeout(hoverHideTimer); });
          pop.addEventListener('mouseleave', ()=>{ if (pinnedKey) return; hoverHideTimer = setTimeout(()=> hidePop(false), 120); });
          btn.addEventListener('click', ()=>{
            if (pinnedKey === opt.key){ pinnedKey = null; hidePop(true); btn.classList.remove('is-pinned'); return; }
            buttons.forEach(b=> b.classList.remove('is-pinned'));
            pinnedKey = opt.key; btn.classList.add('is-pinned'); setActive(opt.key); showPopFor(opt, btn, true);
          });
        }
        btn.addEventListener('keydown', (e)=>{ if (e.key==='Enter' || e.key===' '){ e.preventDefault(); btn.click(); } if (e.key==='Escape'){ pinnedKey=null; hidePop(true);} });
      });

      document.addEventListener('click', (e)=>{
        const inDock  = e.target.closest('.dock');
        const inPop   = e.target.closest('#cta-pop');
        const inForm  = e.target.closest('.form-card');
        if (inDock || inPop || inForm) return;
        pinnedKey = null; hidePop(true);
      });

      // Navigate from action buttons
      sec.addEventListener('click', (e)=>{
        const act = e.target.closest('.act-link'); if (!act) return; e.stopPropagation();
        const href = act.getAttribute('data-href'); if (!href) return;
        try { if (href[0] === '/' && window.history){ history.pushState({}, '', href); dispatchEvent(new Event('popstate')); } else { location.assign(href); } }
        catch(_) { location.assign(href); }
      });
      sec.addEventListener('keydown', (e)=>{
        const act = e.target.closest('.act-link'); if (!act) return;
        if (e.key==='Enter' || e.key===' '){ e.preventDefault(); act.click(); }
      });

      // Auto-open Get Clarity once
      const delay = parseInt(getComputedStyle(sec).getPropertyValue('--auto-open-delay')) || 900;
      let openedOnce = false;
      const io = new IntersectionObserver(entries=>{
        entries.forEach(entry=>{
          if (entry.isIntersecting && !openedOnce){
            setTimeout(()=>{ if (openedOnce) return;
              const clarity = [...dock.children].find(b=>b.dataset.key==='clarity');
              if (clarity){ clarity.classList.add('is-pinned','is-open'); setActive('clarity'); setFormVisible(true); openedOnce = true; }
            }, delay);
            io.disconnect();
          }
        });
      }, { threshold: 0.3 });
      io.observe(sec);

      // Chips wiring
      (function(){
        const engagementHidden = form.querySelector('#engagement');
        form.querySelectorAll('.chip:not([data-radio])').forEach(ch=>{
          ch.addEventListener('click', ()=>{
            const on = ch.dataset.checked === 'true';
            ch.dataset.checked = on ? 'false' : 'true';
            const values = [...form.querySelectorAll('.chip:not([data-radio])[data-checked="true"]')].map(x=>x.dataset.value);
            engagementHidden.value = values.join(', ');
          });
        });
        const channelHidden = form.querySelector('#channel');
        form.querySelectorAll('.chip[data-radio="channel"]').forEach(ch=>{
          ch.addEventListener('click', ()=>{
            form.querySelectorAll('.chip[data-radio="channel"]').forEach(x=>x.dataset.checked='false');
            ch.dataset.checked = 'true'; channelHidden.value = ch.dataset.value;
          });
        });
      })();

      // =============== Fancy Select wiring (enhanced with search + viewport fit) ===============
      function initFancySelect(root){
        const hiddenId   = root.dataset.for;
        const target     = document.getElementById(hiddenId);
        const btn        = root.querySelector('.fs-button');
        const valSpan    = root.querySelector('.fs-value');
        const pop        = root.querySelector('.fs-pop');
        const list       = root.querySelector('.fs-list');
        const wantsSearch= root.dataset.search === 'true';
        const searchEl   = wantsSearch ? root.querySelector('.fs-search') : null;
        let open = false;
        let activeIndex = -1;

        function filterItems(q){
          if(!wantsSearch) return;
          const qq = (q||'').trim().toLowerCase();
          [...list.children].forEach(li=>{
            const label = li.textContent.trim().toLowerCase();
            li.style.display = label.includes(qq) ? '' : 'none';
          });
          const visible = [...list.children].filter(li => li.style.display !== 'none');
          if(visible.length){
            activeIndex = [...list.children].indexOf(visible[0]);
          }
        }

        // Fit popup to available viewport space below the control
        function fitToViewport(){
          const margin = 8;
          const b = btn.getBoundingClientRect();
          const available = Math.max(160, window.innerHeight - b.bottom - margin);
          pop.style.maxHeight = available + 'px';
          const searchH = searchEl ? (searchEl.offsetHeight + 12) : 0;
          const chrome = 16; // padding/borders
          list.style.maxHeight = Math.max(120, available - searchH - chrome) + 'px';
        }

        function setOpen(on){
          open = !!on;
          root.setAttribute('aria-expanded', open ? 'true' : 'false');
          btn.setAttribute('aria-expanded', open ? 'true' : 'false');
          pop.dataset.show = open ? 'true' : 'false';

          if(open){
            // compute & size, then animate in
            const prev = pop.style.display;
            pop.style.display = 'block';
            root.setAttribute('data-pos','below'); // explicit (CSS forces below anyway)
            fitToViewport();

            requestAnimationFrame(()=>{
              pop.setAttribute('data-animate','in');
              if (searchEl){ searchEl.value=''; filterItems(''); searchEl.focus(); }
              else { (activeIndex>=0 ? list.children[activeIndex] : list.children[0]).focus(); }
            });
          } else {
            pop.removeAttribute('data-animate');
          }
        }

        // keep sizing correct while open
        window.addEventListener('resize', ()=>{ if(open) fitToViewport(); });
        window.addEventListener('scroll', ()=>{ if(open) fitToViewport(); }, { passive: true });

        function setValue(v, label){
          if (!target) return;
          target.value = v || '';
          if (v){
            valSpan.textContent = label || v;
            valSpan.classList.remove('fs-placeholder');
          } else {
            valSpan.textContent = 'Select one';
            valSpan.classList.add('fs-placeholder');
          }
          [...list.children].forEach((li,i)=>{
            const on = (li.dataset.value === v);
            li.setAttribute('aria-selected', on ? 'true' : 'false');
            if (on) activeIndex = i;
          });
        }

        function selectByIndex(i){
          const li = list.children[i];
          if (!li || li.style.display==='none') return;
          setValue(li.dataset.value, li.textContent.trim());
          setOpen(false); btn.focus();
        }

        // click to open/close
        btn.addEventListener('click', (e)=>{ e.stopPropagation(); setOpen(!open); });

        // option click
        list.addEventListener('click', (e)=>{
          const li = e.target.closest('.fs-option'); if (!li) return;
          if (li.style.display==='none') return;
          setValue(li.dataset.value, li.textContent.trim()); setOpen(false); btn.focus();
        });

        // keyboard on button
        btn.addEventListener('keydown', (e)=>{
          if (e.key==='ArrowDown' || e.key==='ArrowUp'){
            e.preventDefault();
            setOpen(true);
            if (searchEl) searchEl.focus();
            else (activeIndex>=0? list.children[activeIndex] : list.children[0]).focus();
          }
          if (e.key==='Enter' || e.key===' '){
            e.preventDefault();
            setOpen(!open);
            if (open){ if (searchEl) searchEl.focus(); else (activeIndex>=0? list.children[activeIndex] : list.children[0]).focus(); }
          }
          if (e.key==='Escape'){ setOpen(false); }
        });

        // keyboard on list
        list.addEventListener('keydown', (e)=>{
          const all = [...list.children].filter(li => li.style.display !== 'none');
          const max = all.length - 1;
          const idxInAll = (el)=> all.indexOf(el);

          if (e.key==='ArrowDown'){ e.preventDefault(); activeIndex = Math.min(max, (idxInAll(list.children[activeIndex]) + 1) || 0); (all[activeIndex]||all[0]).focus(); }
          if (e.key==='ArrowUp'){   e.preventDefault(); activeIndex = Math.max(0,   (idxInAll(list.children[activeIndex]) - 1) || 0); (all[activeIndex]||all[0]).focus(); }
          if (e.key==='Home'){ e.preventDefault(); activeIndex = 0; (all[0]||list.children[0]).focus(); }
          if (e.key==='End'){  e.preventDefault(); activeIndex = max; (all[max]||list.children[list.children.length-1]).focus(); }
          if (e.key==='Enter' || e.key===' '){ e.preventDefault(); if(all[activeIndex]) setValue(all[activeIndex].dataset.value, all[activeIndex].textContent.trim()), setOpen(false), btn.focus(); }
          if (e.key==='Escape'){ e.preventDefault(); setOpen(false); btn.focus(); }
        });

        // live filter
        if (searchEl){
          searchEl.addEventListener('input', (e)=> filterItems(e.target.value));
          searchEl.addEventListener('click', (e)=> e.stopPropagation());
          searchEl.addEventListener('keydown', (e)=>{
            if (e.key==='ArrowDown'){ e.preventDefault();
              const firstVisible = [...list.children].find(li => li.style.display !== 'none');
              if (firstVisible) { activeIndex = [...list.children].indexOf(firstVisible); firstVisible.focus(); }
            }
            if (e.key==='Escape'){ e.preventDefault(); setOpen(false); btn.focus(); }
          });
        }

        // set tabindex and initial aria state
        [...list.children].forEach((li)=> li.setAttribute('tabindex','-1'));
        // close on outside click
        document.addEventListener('click', (e)=>{ if (!root.contains(e.target)) setOpen(false); });

        // initial
        setValue(target.value || '');
      }

      // --- Countries (UN list + common territories) ---
      const COUNTRIES = `Afghanistan|Albania|Algeria|Andorra|Angola|Antigua and Barbuda|Argentina|Armenia|Australia|Austria|Azerbaijan|Bahamas|Bahrain|Bangladesh|Barbados|Belarus|Belgium|Belize|Benin|Bhutan|Bolivia|Bosnia and Herzegovina|Botswana|Brazil|Brunei|Bulgaria|Burkina Faso|Burundi|Cabo Verde|Cambodia|Cameroon|Canada|Central African Republic|Chad|Chile|China|Colombia|Comoros|Congo (Congo-Brazzaville)|Costa Rica|Côte d’Ivoire|Croatia|Cuba|Cyprus|Czechia|Democratic Republic of the Congo|Denmark|Djibouti|Dominica|Dominican Republic|Ecuador|Egypt|El Salvador|Equatorial Guinea|Eritrea|Estonia|Eswatini|Ethiopia|Fiji|Finland|France|Gabon|Gambia|Georgia|Germany|Ghana|Greece|Grenada|Guatemala|Guinea|Guinea-Bissau|Guyana|Haiti|Honduras|Hungary|Iceland|India|Indonesia|Iran|Iraq|Ireland|Israel|Italy|Jamaica|Japan|Jordan|Kazakhstan|Kenya|Kiribati|Kuwait|Kyrgyzstan|Laos|Latvia|Lebanon|Lesotho|Liberia|Libya|Liechtenstein|Lithuania|Luxembourg|Madagascar|Malawi|Malaysia|Maldives|Mali|Malta|Marshall Islands|Mauritania|Mauritius|Mexico|Micronesia|Moldova|Monaco|Mongolia|Montenegro|Morocco|Mozambique|Myanmar|Namibia|Nauru|Nepal|Netherlands|New Zealand|Nicaragua|Niger|Nigeria|North Korea|North Macedonia|Norway|Oman|Pakistan|Palau|Panama|Papua New Guinea|Paraguay|Peru|Philippines|Poland|Portugal|Qatar|Romania|Russia|Rwanda|Saint Kitts and Nevis|Saint Lucia|Saint Vincent and the Grenadines|Samoa|San Marino|Sao Tome and Principe|Saudi Arabia|Senegal|Serbia|Seychelles|Sierra Leone|Singapore|Slovakia|Slovenia|Solomon Islands|Somalia|South Africa|South Korea|South Sudan|Spain|Sri Lanka|Sudan|Suriname|Sweden|Switzerland|Syria|Taiwan|Tajikistan|Tanzania|Thailand|Timor-Leste|Togo|Tonga|Trinidad and Tobago|Tunisia|Turkey|Turkmenistan|Tuvalu|Uganda|Ukraine|United Arab Emirates|United Kingdom|United States|Uruguay|Uzbekistan|Vanuatu|Vatican City|Venezuela|Vietnam|Yemen|Zambia|Zimbabwe`.split('|');

      // Populate the country list if that Fancy-Select exists
      (function mountCountryList(){
        const root = sec.querySelector('.fselect[data-for="country_value"]');
        if(!root) return;
        const list = root.querySelector('.fs-list');
        if(!list) return;
        list.innerHTML = COUNTRIES.map(n =>
          `<li class="fs-option" role="option" data-value="${n}" tabindex="0"><span class="fs-check"></span>${n}</li>`
        ).join('');
      })();

      // Mount all Fancy Selects
      sec.querySelectorAll('.fselect').forEach(initFancySelect);

      // ====== Form submit -> validate only name, email, message ======
      function showError(msg){
        hint.textContent = msg || '';
        hint.setAttribute('aria-hidden','false');   // show error
        note.hidden = true;                         // hide the constant note while error shows
      }
      function clearError(){
        hint.textContent = '';
        hint.setAttribute('aria-hidden','true');    // hide error
        note.hidden = false;                        // show the constant note
      }

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    clearError();

    const REQUIRED = ['name','email','message'];
    const data = Object.fromEntries(new FormData(form).entries());

    // clear previous invalid states
    REQUIRED.forEach(id=>{
      const el = form.querySelector('#'+id);
      if (el) el.classList.remove('is-invalid');
    });

    // check required fields
    const missing = REQUIRED.filter(k => !data[k] || (''+data[k]).trim()==='');
    if (missing.length){
      missing.forEach(k=>{
        const el = form.querySelector('#'+k);
        if (el) el.classList.add('is-invalid');
      });
      const first = form.querySelector('#'+missing[0]);
      if (first){
        first.focus({preventScroll:false});
        first.scrollIntoView({behavior:'smooth', block:'center'});
      }
      showError('Please complete all required fields.');
      return;
    }

// build payload (includes your hidden fields like role/channel/etc.)
const fd = new FormData(form);

// reCAPTCHA v3 token (silent)
try {
  if (window.grecaptcha) {
    // ensure the API is ready, then get a token for "submit" action
    await grecaptcha.ready(async () => {
      const token = await grecaptcha.execute('6Lc4gs0rAAAAAI0aXXts_OCCquoEdduHM5l98EcH', { action: 'submit' });
      // set hidden input (for completeness) and include in FormData
      const hidden = document.getElementById('g-recaptcha-response');
      if (hidden) hidden.value = token;
      fd.set('g-recaptcha-response', token);
    });
  }
} catch (_) {
  // If token fails for any reason, we still proceed (honeypot + Formspree filtering still help)
}


    // disable button during submit
    const btn = form.querySelector('.btn-primary');
    const btnLabel = btn ? btn.textContent : '';
    if (btn){ btn.disabled = true; btn.textContent = 'Sending…'; }

    try{
      const res = await fetch(form.getAttribute('action'), {
        method: 'POST',
        headers: { 'Accept': 'application/json' },
        body: fd
      });

      if (res.ok){
        // success: reset UI, show modal
        form.reset();
        form.querySelectorAll('.chip').forEach(x=>x.dataset.checked='false');
        ['engagement','channel','role_value','when_value','country_value'].forEach(id=>{
          const el = form.querySelector('#'+id); if (el) el.value = '';
        });
        // reset fancy-select labels
        document.querySelectorAll('#cta .fselect .fs-value').forEach(v=>{
          v.textContent = 'Select one';
          v.classList.add('fs-placeholder');
        });
        clearError();
        openModal();
      } else {
        let msg = 'Something went wrong. Please try again or email us.';
        try {
          const j = await res.json();
          if (j && j.errors && j.errors.length){
            msg = j.errors.map(e => e.message).join(' ');
          }
        } catch(_){}
        showError(msg);
      }
    } catch(err){
      showError('Network error. Please try again or reach us via email.');
    } finally {
      if (btn){ btn.disabled = false; btn.textContent = btnLabel; }
    }
  });

     // Live: remove red outline as user types
      ['name','email','message'].forEach(id=>{
        const el = form.querySelector('#'+id);
        if (!el) return;
        el.addEventListener('input', ()=> el.classList.remove('is-invalid'));
      });

      function openModal(){ modal.setAttribute('aria-hidden','false'); sec.setAttribute('aria-busy','true'); modal.querySelector('[data-close-modal]').focus(); }
      function closeModal(){ modal.setAttribute('aria-hidden','true'); sec.removeAttribute('aria-busy'); }
      modal.addEventListener('click', (e)=>{ if (e.target === modal) closeModal(); });
      modal.querySelector('[data-close-modal]').addEventListener('click', closeModal);
      window.addEventListener('keydown', (e)=>{ if (e.key==='Escape') closeModal(); });

      // Dev helper
      sec._cta = { buttons };
    })();
  </script>

  <!-- Section-local video initializer (same pattern as #ways-we-work) -->
  <script>
    (function(){
      const layer = document.querySelector('#cta .vid-layer');
      if(!layer) return;
      const vid = layer.querySelector('video.vid');
      if(!vid) return;

      function applyControls(){
        const op    = parseFloat(layer.dataset.opacity ?? '.28');
        const rate  = parseFloat(layer.dataset.speed   ?? '1.0');
        const blend = (layer.dataset.blend || 'soft-light').trim();
        layer.style.setProperty('--vid-opacity', isFinite(op) ? op : .28);
        layer.style.setProperty('--vid-blend', blend || 'soft-light');
        try { vid.playbackRate = isFinite(rate) ? rate : 1.0; } catch(e){}
      }

      const io = new IntersectionObserver((entries)=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting){
            applyControls();
            const p = vid.play(); if(p && p.catch){ p.catch(()=>{}); }
          } else {
            vid.pause();
          }
        });
      }, { threshold: 0.2 });

      io.observe(layer);
    })();
  </script>
  <script src="https://www.google.com/recaptcha/api.js?render=6Lc4gs0rAAAAAI0aXXts_OCCquoEdduHM5l98EcH" async defer></script>

</section>
