<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Elysian Advisory</title>

<!-- Preload the single global video -->
<link rel="preload" as="video" href="video.webm" type="video/webm">

<style>
  :root {
    --vh: 100svh;

    /* Brand + background controls */
    --page-bg:#fffcf8;    /* background */
    --ink:#13294B;        /* text color */
    --video-opacity:0.03; /* default video opacity */
    --tint-opacity:0.00;  /* optional tiny color cast */
  }

  /* State for final reveal */
  :root.final-reveal {
    --page-bg:#FFFFFF;     /* pure white */
    --video-opacity:0.001;  /* soften texture at end */
  }

  *{ box-sizing:border-box; margin:0; padding:0; }

  html, body{ height:100%; overflow:hidden; }
  html{ background-color:var(--page-bg); color:var(--ink); transition: background-color .6s ease; }
  body{ font:400 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color:var(--ink); }

  /* Local fonts */
  @font-face { font-family:'Anecor'; src:url('./Fonts/anecor-gheroos.otf') format('opentype'); font-display:swap; }

  /* ===== GLOBAL BACKGROUND LAYER (one per site) ===== */
  #site-bg{
    position:fixed; inset:0; z-index:0;
    background-color:var(--page-bg);
    pointer-events:none; overflow:hidden;
    transition: background-color .6s ease; /* smooth flip */
  }
  #bg-video{
    position:absolute; top:50%; left:50%;
    min-width:100%; min-height:100%;
    transform:translate(-50%,-50%);
    object-fit:cover;
    opacity:var(--video-opacity);
    transition: opacity .6s ease;   /* added */
  }
  /* Optional soft-light tint */
  #bg-tint{
    position:absolute; inset:0;
    mix-blend-mode:soft-light;
    background:var(--ink);
    opacity:var(--tint-opacity);
  }
  @media (prefers-reduced-motion: reduce){
    #bg-video{ display:none; }
    #bg-tint{ mix-blend-mode:normal; opacity:0.06; }
  }

  /* Scrollable stack area */
  #stackScroll{
    position:fixed; inset:0; width:100vw; height:var(--vh);
    overflow-y:auto; overflow-x:hidden; -webkit-overflow-scrolling:touch;
    scroll-snap-type:y mandatory;
    background:transparent;
    z-index:1;
  }
  .stack-section{
    position:relative; width:100vw; height:var(--vh);
    scroll-snap-align:start; scroll-snap-stop:always; overflow:hidden;
  }

  /* Seam-guard */
  .stack-frame{
    position:absolute; top:-1px; left:-1px;
    width: calc(100vw + 2px); height: calc(var(--vh) + 2px);
    display:block; border:0; background:transparent;
  }

  /* Fixed glass nav */
  .subtle-nav{
    position:fixed; top:20px; right:24px;
    display:flex; gap:6px; padding:8px 10px;
    border-radius:999px;
    background:rgba(255,255,255,.55);
    border:1px solid rgba(0,0,0,.07);
    backdrop-filter:none;
    -webkit-backdrop-filter:none;
    box-shadow:0 8px 24px rgba(0,0,0,.06);
    color:var(--ink);
    opacity:0; transform:translateY(-6px);
    z-index:9999; pointer-events:none;
    transition:opacity .25s ease, transform .25s ease;
  }
  .subtle-nav.is-visible{
    opacity:.95; transform:translateY(0); pointer-events:auto;
  }
  .subtle-nav:hover{
    opacity:1; box-shadow:0 10px 28px rgba(0,0,0,.06);
  }
  .nav-btn{
    background:transparent; border:0; border-radius:999px;
    padding:6px 10px; cursor:pointer;
    font:600 12px/1.1 'Anecor', system-ui, -apple-system, Segoe UI, sans-serif;
    letter-spacing:.12em; text-transform:uppercase;
    transition:opacity .2s ease, background-color .2s ease, transform .12s ease;
    color:var(--ink);
  }
  .nav-btn:hover{ background:rgba(0,0,0,.04); }
  .nav-btn:active{ transform:translateY(1px); }

  footer{
    position:fixed; left:0; right:0; bottom:8px; text-align:center;
    color:#777; font-size:12px; pointer-events:none;
  }

  /* ===== Dock Logo (visible from Section 2 onward) ===== */
  :root{
    --dock-logo-w: clamp(90px, 8vw, 170px);
    --dock-logo-top: calc(18px + env(safe-area-inset-top));
    --dock-logo-left: 18px;
    --dock-reveal-blur: 10px;
    --dock-reveal-scale: .96;
    --dock-shadow-strong: 0 20px 30px rgba(0,0,0,.08);
    --dock-shadow-soft: 0 10px 18px rgba(0,0,0,.06);
  }
  #ElysianDockLogo{
    position:fixed; z-index:10000; pointer-events:none;
    top:var(--dock-logo-top); left:var(--dock-logo-left);
    width:var(--dock-logo-w); height:auto;
    opacity:0;
    filter: blur(var(--dock-reveal-blur)) drop-shadow(var(--dock-shadow-strong));
    transform-origin: top left; transform: scale(var(--dock-reveal-scale));
    transition:
      opacity .50s cubic-bezier(.25,1,.5,1),
      filter .65s cubic-bezier(.25,1,.5,1),
      transform .65s cubic-bezier(.25,1,.5,1);
  }
  #ElysianDockLogo > img,
  #ElysianDockLogo > svg{
    display:block; width:100%; height:auto;
  }
  body.logo-visible #ElysianDockLogo{
    opacity:1;
    filter: blur(0) drop-shadow(var(--dock-shadow-soft));
    transform: scale(1);
  }
  @media (prefers-reduced-motion: reduce){
    #ElysianDockLogo{ transition:none; filter:none; transform:none; }
  }
</style>
</head>
<body>

  <!-- ONE global background (video + optional tint) -->
  <div id="site-bg" aria-hidden="true">
    <video id="bg-video" muted playsinline autoplay loop preload="metadata" poster="video-poster.jpg">
      <source src="video.webm" type="video/webm">
      <source src="3.mp4" type="video/mp4">
    </video>
    <div id="bg-tint"></div>
  </div>

  <!-- Fixed, site-wide logo that appears from Section 2 onward (top-left) -->
  <div id="ElysianDockLogo" aria-hidden="true">
    <img src="./assets/LS.svg" alt="Elysian Advisory" decoding="async" fetchpriority="low" width="200" height="60" />
  </div>

  <nav class="subtle-nav" id="globalHeroNav" aria-label="Primary">
    <button class="nav-btn" type="button" data-target="writings">Writings</button>
    <button class="nav-btn" type="button" data-target="instruments">Instruments</button>
    <button class="nav-btn" type="button" data-target="connect">Connect</button>
  </nav>

  <main id="stackScroll" aria-label="Stacked sections"></main>

  <script>
    /* Per-section background controls */
    const BG_CONFIG = {
      hero:     { opacity: 0.03, speed: 0.6 },
      for:      { opacity: 0.03, speed: 0.6 },
      action:   { opacity: 0.03, speed: 0.6 },
      truth:    { opacity: 0.03, speed: 0.6 },
      work:     { opacity: 0.03, speed: 0.6 },
      trust:    { opacity: 0.03, speed: 0.6 },
      'trust-2':{ opacity: 0.03, speed: 0.6 }
    };

    /* Sections */
    const SECTION_MANIFEST = [
      { id: 'hero',    title: 'Hero',               src: './sections/01.html' },
      { id: 'for',     title: 'Clarity For',        src: './sections/02.html' },
      { id: 'action',  title: 'Clarity In Action',  src: './sections/03.html' },
      { id: 'truth',   title: 'Truth',              src: './sections/04.html' },
      { id: 'work',    title: 'Work With Us',       src: './sections/05.html' },
      { id: 'trust',   title: 'Trust Us',           src: './sections/06.html' },
      { id: 'trust-2', title: 'Trust Us',           src: './sections/07.html' }
    ];

    /* Viewport height fix (--vh) */
    function setVH(){
      const h = Math.max(1, Math.round(window.innerHeight || document.documentElement.clientHeight || 0));
      document.documentElement.style.setProperty('--vh', h + 'px');
    }
    setVH();
    window.addEventListener('resize', setVH, { passive:true });
    window.addEventListener('orientationchange', setVH);

    /* Build the stack */
    const stackEl = document.getElementById('stackScroll');

    function injectNoScrollCSS(doc){
      try{
        const style = doc.createElement('style');
        style.textContent =
`html,body{height:100%;overflow:hidden!important;margin:0!important;padding:0!important;background:transparent!important;}
*{box-sizing:border-box;}
::-webkit-scrollbar{display:none;}`;
        doc.head.appendChild(style);
      }catch(e){}
    }

    function makeStack(){
      stackEl.innerHTML = '';
      SECTION_MANIFEST.forEach(({id, title, src}, idx) => {
        const wrapper = document.createElement('section');
        wrapper.className = 'stack-section';
        wrapper.id = 'sec-' + id;
        wrapper.setAttribute('aria-label', title || `Section ${idx+1}`);

        const conf = BG_CONFIG[id] || {};
        if (conf.opacity != null) wrapper.dataset.bgOpacity = String(conf.opacity);
        if (conf.speed   != null) wrapper.dataset.bgSpeed   = String(conf.speed);

        const frame = document.createElement('iframe');
        frame.className = 'stack-frame';
        frame.id = 'frame-' + id;
        frame.title = title || src;
        frame.dataset.src = src;
        frame.loading = idx === 0 ? 'eager' : 'lazy';
        frame.referrerPolicy = 'no-referrer';
        frame.setAttribute('allowtransparency','true');
        frame.setAttribute('scrolling','no');

        frame.addEventListener('load', () => {
          try{
            const doc = frame.contentDocument;
            if(!doc) return;
            injectNoScrollCSS(doc);
          }catch(e){}
        });

        frame.addEventListener('error', (e) => {
          console.error('Iframe failed to load:', src, e);
        });

        wrapper.appendChild(frame);
        stackEl.appendChild(wrapper);
      });
    }
    makeStack();

    // Lazy-activate frames
    const framesState = new Map();
    const framesObserver = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        const frame = entry.target;
        const id = frame.id || frame.title || frame.dataset.src;

        if (!framesState.has(id)) framesState.set(id, {live:false});

        if (entry.isIntersecting && !framesState.get(id).live) {
          frame.src = frame.dataset.src;
          framesState.get(id).live = true;
        } else if (!entry.isIntersecting) {
          const rect = frame.getBoundingClientRect();
          const vh = window.innerHeight || document.documentElement.clientHeight;
          if (rect.top > vh*2 || rect.bottom < -vh*2) {
            if (framesState.get(id).live) {
              frame.src = 'about:blank';
              framesState.get(id).live = false;
            }
          }
        }
      });
    }, { root: document.getElementById('stackScroll'), rootMargin: '120% 0px', threshold: 0.01 });

    document.querySelectorAll('.stack-frame').forEach(f => framesObserver.observe(f));

    /* Nav + logo visibility */
    const globalNav = document.getElementById('globalHeroNav');

    function currentIndex(){
      const vh = Math.max(1, Math.round(window.innerHeight || document.documentElement.clientHeight));
      const idx = Math.floor((stackEl.scrollTop + vh * 0.1) / vh);
      return idx;
    }

    function updateChrome(){
      const idx = currentIndex();
      if (idx >= 1){
        globalNav.classList.add('is-visible');
        document.body.classList.add('logo-visible');
      }else{
        globalNav.classList.remove('is-visible');
        document.body.classList.remove('logo-visible');
      }
    }

    stackEl.addEventListener('scroll', () => {
      requestAnimationFrame(updateChrome);
    }, { passive:true });

    window.addEventListener('resize', updateChrome, { passive:true });
    updateChrome();

    /* Background controller (VIDEO opacity + speed + final reveal) */
    const bgVideo = document.getElementById('bg-video');
    const rootEl  = document.documentElement;

    const DEFAULT_VIDEO_OPACITY = parseFloat(getComputedStyle(rootEl).getPropertyValue('--video-opacity')) || 0.22;
    const DEFAULT_BG_SPEED      = 0.8;

    function applyBG(sectionEl){
      const o = parseFloat(sectionEl?.dataset.bgOpacity ?? '');
      const s = parseFloat(sectionEl?.dataset.bgSpeed   ?? '');
      const videoOpacity = Number.isFinite(o) ? o : DEFAULT_VIDEO_OPACITY;
      const speed        = Number.isFinite(s) ? s : DEFAULT_BG_SPEED;

      rootEl.style.setProperty('--video-opacity', String(videoOpacity));
      try{ bgVideo.playbackRate = speed; }catch(e){}
    }

    const firstSection = document.querySelector('.stack-section');
    if (firstSection) applyBG(firstSection);
let finalTimer = null;

const bgObserver = new IntersectionObserver((entries)=>{
  entries.forEach(entry=>{
    // Always apply the BG settings for whichever section reported
    if (entry.isIntersecting) applyBG(entry.target);

    // Only control the reveal based on the final section itself
    if (entry.target.id === 'sec-trust-2') {
      if (entry.isIntersecting) {
        clearTimeout(finalTimer);
        finalTimer = setTimeout(()=> {
          document.documentElement.classList.add('final-reveal');
        }, 4000); // keep your intended delay
      } else {
        clearTimeout(finalTimer);
        document.documentElement.classList.remove('final-reveal');
      }
    }
  });
}, { root: stackEl, threshold: 0.6 });

// attach observer to sections
document.querySelectorAll('.stack-section').forEach(s => bgObserver.observe(s));
    
    /* Ensure autoplay */
    (function ensurePlay(){
      const v = document.getElementById('bg-video');
      if (!v) return;
      v.muted = true;
      const p = v.play && v.play();
      if (p && p.catch) p.catch(()=>{});
    })();
  </script>
</body>
</html>


